/*! @ridi/reader.js v1.0.45 */

if(function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).ReaderJS=f()}}(function(){return function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){return o(e[i][1][r]||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_Content3=require("../common/_Content"),_Content4=(obj=_Content3)&&obj.__esModule?obj:{default:obj};var Content=function(_Content2){function Content(reader,wrapper,src){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Content);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,(Content.__proto__||Object.getPrototypeOf(Content)).call(this,reader,wrapper));return _this._src=src,_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Content,_Content4.default),_createClass(Content,[{key:"src",get:function(){return this._src}}]),_createClass(Content,[{key:"reviseImagesInSpine",value:function(screenWidth,screenHeight){for(var results=[],els=this.images,i=0;i<els.length;i+=1){var el=els[i],result=this.reviseImage(el,screenWidth,screenHeight);(result.width.length||result.height.length||result.position.length)&&results.push({el:el,width:result.width,height:result.height,position:result.position})}results.forEach(function(result){var el=result.el,width=result.width,height=result.height,position=result.position;width.length&&(el.style.width=width),height.length&&(el.style.height=height),position.length&&(el.style.position=position)})}},{key:"reviseImage",value:function(imgEl,screenWidth,screenHeight){var result=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;return void 0!==getter?getter.call(receiver):void 0}(Content.prototype.__proto__||Object.getPrototypeOf(Content.prototype),"reviseImage",this).call(this,imgEl,screenWidth,screenHeight);if(0===result.size.dWidth||0===result.size.dHeight){var el=imgEl.parentElement;do{if(el.nodeName.match(/H[0-9]/)){result.position="absolute";break}}while(el=el.parentElement)}return result}},{key:"findRectFromElementId",value:function(id){var rect=this.getRectFromElementId(id);if(rect){var _reader$rectToAbsolut=this._reader.rectToAbsolute(rect),left=_reader$rectToAbsolut.left,top=_reader$rectToAbsolut.top,width=_reader$rectToAbsolut.width,height=_reader$rectToAbsolut.height;android.onElementRectFound(left,top,width,height)}else android.onElementRectNotFound()}}]),Content}();exports.default=Content},{"../common/_Content":11}],2:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_Context3=require("../common/_Context"),_Context4=(obj=_Context3)&&obj.__esModule?obj:{default:obj};var Context=function(_Context2){function Context(){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Context),function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,(Context.__proto__||Object.getPrototypeOf(Context)).apply(this,arguments))}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Context,_Context4.default),_createClass(Context,[{key:"pageWidthUnit",get:function(){return(this._width+this.pageGap)*(this.isDoublePageMode?2:1)}}]),Context}();exports.default=Context},{"../common/_Context":12}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_Handler4=_interopRequireDefault(require("../common/_Handler")),_Util2=_interopRequireDefault(require("./Util"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Handler=function(_Handler2){function Handler(){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Handler),function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,(Handler.__proto__||Object.getPrototypeOf(Handler)).apply(this,arguments))}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Handler,_Handler4.default),_createClass(Handler,[{key:"processSingleTapEvent",value:function(x,y,nativePoints){var link=this.getLinkFromPoint(x,y);if(null!==link){var href=link.href||"",type=link.type||"";if(href.length){var range=document.createRange();range.selectNodeContents(link.node);var rects=this.reader.rectsToAbsoluteCoord(range.getAdjustedClientRects()),footnoteType="noteref"===type?3:2,text=link.node.textContent||"",canUseFootnote=null!==href.match(/^file:\/\//gm)&&(null!==text.trim().match(_Util2.default.getFootnoteRegex())||3<=footnoteType);if(canUseFootnote){var src=href.replace(window.location.href,"");if("#"===src[0]||null!==src.match(this.reader.content.src)){var anchor=src.substring(src.lastIndexOf("#")+1),offset=this.reader.getOffsetFromAnchor(anchor);canUseFootnote=this.reader.context.isScrollMode?offset>=this.reader.pageYOffset:offset>=this.reader.curPage}}return void android.onLinkPressed(href,rects,canUseFootnote,3<=footnoteType?text:null)}}android.onSingleTapEventNotProcessed(nativePoints)}},{key:"processImageZoomEvent",value:function(x,y){var content=this.reader.content,point=this.reader.adjustPoint(x,y),result=content.getImageFromPoint(point.x,point.y);if(result){var _reader$rectToAbsolut=this.reader.rectToAbsolute(result.rect),left=_reader$rectToAbsolut.left,top=_reader$rectToAbsolut.top,width=_reader$rectToAbsolut.width,height=_reader$rectToAbsolut.height;android.onImageFound(result.src,result.id,left,top,width,height)}else if(result=content.getSvgFromPoint(point.x,point.y)){var _reader$rectToAbsolut2=this.reader.rectToAbsolute(result.rect),_left=_reader$rectToAbsolut2.left,_top=_reader$rectToAbsolut2.top,_width=_reader$rectToAbsolut2.width,_height=_reader$rectToAbsolut2.height;android.onSvgFound(result.html,result.id,_left,_top,_width,_height)}}}]),Handler}();exports.default=Handler},{"../common/_Handler":13,"./Util":7}],4:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;return void 0!==getter?getter.call(receiver):void 0},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_Reader4=_interopRequireDefault(require("../common/_Reader")),_Content2=_interopRequireDefault(require("./Content")),_Chrome2=_interopRequireDefault(require("../common/Chrome")),_Handler2=_interopRequireDefault(require("./Handler")),_Sel2=_interopRequireDefault(require("./Sel")),_Util2=_interopRequireDefault(require("./Util"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Reader=function(_Reader2){function Reader(wrapper,context,curPage,contentSrc){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Reader);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,(Reader.__proto__||Object.getPrototypeOf(Reader)).call(this,wrapper,context));return _this._content=new _Content2.default(_this,wrapper,contentSrc),_this._handler=new _Handler2.default(_this),_this._sel=new _Sel2.default(_this),_this._chrome=new _Chrome2.default(_this,curPage),_this.chrome.addScrollListenerIfNeeded(),_this.calcPageForDoublePageMode=!1,_this._updateClientWidth(),_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Reader,_Reader4.default),_createClass(Reader,[{key:"chrome",get:function(){return this._chrome}},{key:"htmlClientWidth",get:function(){return this._htmlClientWidth}},{key:"bodyClientWidth",get:function(){return this._bodyClientWidth}}]),_createClass(Reader,[{key:"adjustPoint",value:function(x,y){return this.chrome.adjustPoint(this,x,y)}},{key:"adjustRect",value:function(rect){return this.chrome.adjustRect(this,rect)}},{key:"changeContext",value:function(context,curPage){_get(Reader.prototype.__proto__||Object.getPrototypeOf(Reader.prototype),"changeContext",this).call(this,context),this.chrome.isCursed&&(this.chrome.removeScrollListenerIfNeeded(),this._chrome=new _Chrome2.default(this,curPage),this.chrome.addScrollListenerIfNeeded())}},{key:"_easeInOut",value:function(currentTime,start,change,duration){var time=currentTime;return(time/=duration/2)<1?change/2*time*time+start:-change/2*((time-=1)*(time-2)-1)+start}},{key:"scrollTo",value:function(){var _this2=this,offset=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,animated=1<arguments.length&&void 0!==arguments[1]&&arguments[1],adjustOffset=offset,body=this.content.body;if(this.context.isScrollMode){var height=this.context.pageHeightUnit,paddingTop=_Util2.default.getStylePropertyIntValue(body,"padding-top"),paddingBottom=_Util2.default.getStylePropertyIntValue(body,"padding-bottom"),maxOffset=this.totalHeight-height-paddingBottom,diff=maxOffset-adjustOffset;paddingTop<adjustOffset&&diff<height&&0<diff&&(adjustOffset=maxOffset),adjustOffset=Math.min(adjustOffset,maxOffset)}else if(-1<this.calcPageCount()){var width=this.context.pageWidthUnit,maxPage=Math.max(this.calcPageCount()-this.getExtraPageCount(),0);adjustOffset=Math.min(adjustOffset,maxPage*width)}if(animated){this._scrollTimer&&(clearTimeout(this._scrollTimer),this._scrollTimer=null);var start=this.context.isScrollMode?this.pageYOffset:this.pageXOffset,change=adjustOffset-start;!function animateScroll(elapsedTime){var time=elapsedTime+20;_get(Reader.prototype.__proto__||Object.getPrototypeOf(Reader.prototype),"scrollTo",_this2).call(_this2,_this2._easeInOut(time,start,change,200)),_this2._scrollTimer=time<200?setTimeout(function(){animateScroll(time)},20):null}(0)}else _get(Reader.prototype.__proto__||Object.getPrototypeOf(Reader.prototype),"scrollTo",this).call(this,adjustOffset)}},{key:"getExtraPageCount",value:function(){var height=this.context.pageHeightUnit;return _Util2.default.getStylePropertyIntValue(this.content.body,"margin-bottom")/(this.context.isDoublePageMode?2*height:height)}},{key:"calcPageCount",value:function(){if(document.fonts){var fontFaceLoadingStatusList=[];if(document.fonts.forEach(function(fontFace){return fontFaceLoadingStatusList.push(fontFace.status)}),0<=fontFaceLoadingStatusList.indexOf("loading"))return-1}if(this.context.isScrollMode)return Math.round(this.totalHeight/this.context.pageHeightUnit);var columnWidth=this.context.pageWidthUnit-this.context.pageGap;if(this.totalWidth<columnWidth)return-1;var version=this.context.chromeMajorVersion;if(45<=version&&version<60){var pageCount=parseFloat(window.getComputedStyle(this.content.body).height,10)/this.context.pageHeightUnit;return this.context.isDoublePageMode&&(pageCount/=2),Math.max(Math.ceil(pageCount),1)}return Math.ceil(this.totalWidth/this.context.pageWidthUnit)}},{key:"getPageFromRect",value:function(rect,el){if(null===rect)return null;var direction=this.getOffsetDirectionFromElement(el),offset=(rect[direction]+this.pageOffset)/("left"===direction?this.context.pageWidthUnit:this.context.pageHeightUnit),fOffset=Math.floor(offset);if(this.calcPageForDoublePageMode){var rOffset=Math.round(offset);return fOffset===rOffset?fOffset:rOffset-.5}return fOffset}},{key:"getRectsFromSerializedRange",value:function(index,serializedRange){var rects=_get(Reader.prototype.__proto__||Object.getPrototypeOf(Reader.prototype),"getRectsFromSerializedRange",this).call(this,serializedRange);android.onRectsOfSerializedRange(index,serializedRange,this.rectsToAbsoluteCoord(rects))}},{key:"getNodeLocationOfCurrentPage",value:function(){var type=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"top",posSeparator=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"#",endOffset=this.context.pageUnit,location=this.findNodeLocation(0,endOffset,type,posSeparator);this.showNodeLocationIfNeeded(),location?android.onNodeLocationOfCurrentPageFound(location):android.onNodeLocationOfCurrentPageNotFound()}},{key:"fixColumnCollapseIssue",value:function(){var id="LayoutNG-last-sentence-missing-error-workaround",div=document.getElementById(id);div||((div=document.createElement("div")).setAttribute("id",id),document.body.appendChild(div))}},{key:"changePageSizeWithStyle",value:function(width,height,gap,style){var _this3=this,prevPage=this.curPage;this.changeContext(Object.assign(this.context,{_width:width,_height:height,_gap:gap}));var styleElements=document.getElementsByTagName("style");styleElements[styleElements.length-1].innerHTML=style,this.setViewport(),this._updateClientWidth(),setTimeout(function(){var maxPage=_this3.calcPageCount();-1<maxPage&&(prevPage=Math.min(prevPage,Math.max(maxPage-1-_this3.getExtraPageCount(),0))),_this3.scrollTo(prevPage*_this3.context.pageUnit)},0)}},{key:"_updateClientWidth",value:function(){this._htmlClientWidth=this.content.wrapper.clientWidth,this._bodyClientWidth=this.content.body.clientWidth}},{key:"_moveTo",value:function(){var method=arguments.length<=0?void 0:arguments[0];if(this.context.isScrollMode){var scrollY=this["getOffsetFrom"+method](arguments.length<=1?void 0:arguments[1]);if(null!==scrollY)return void android["onScrollYOffsetOf"+method+"Found"](android.dipToPixel(scrollY))}else{var page=this["getOffsetFrom"+method](arguments.length<=1?void 0:arguments[1]);if(null!==page)return void android["onPageOffsetOf"+method+"Found"](page)}android["on"+method+"NotFound"]()}},{key:"moveToAnchor",value:function(anchor){this._moveTo("Anchor",anchor)}},{key:"moveToSerializedRange",value:function(serializedRange){this._moveTo("SerializedRange",serializedRange)}},{key:"moveToNodeLocation",value:function(location){this._moveTo("NodeLocation",location)}}]),Reader}();exports.default=Reader},{"../common/Chrome":9,"../common/_Reader":15,"./Content":1,"./Handler":3,"./Sel":5,"./Util":7}],5:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;return void 0!==getter?getter.call(receiver):void 0},_Sel4=_interopRequireDefault(require("../common/_Sel")),_Util2=_interopRequireDefault(require("./Util"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Sel=function(_Sel2){function Sel(){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Sel),function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,(Sel.__proto__||Object.getPrototypeOf(Sel)).apply(this,arguments))}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Sel,_Sel4.default),_createClass(Sel,[{key:"isOutOfBounds",value:function(range){var pageWidth=_Util2.default.getStylePropertyIntValue(this.reader.content.wrapper,"width"),testRange=document.createRange();return testRange.selectNode(range.endContainer),testRange.getAdjustedBoundingClientRect().left>pageWidth}},{key:"getUpperBound",value:function(){return this.reader.context.pageWidthUnit}},{key:"expandSelectionIntoNextPage",value:function(){if(_get(Sel.prototype.__proto__||Object.getPrototypeOf(Sel.prototype),"expandSelectionIntoNextPage",this).call(this)){var coord=this.getSelectedRectsCoord();coord.length&&android.onSelectionChangeIntoNextPage(coord)}}},{key:"startSelectionMode",value:function(x,y){if(_get(Sel.prototype.__proto__||Object.getPrototypeOf(Sel.prototype),"startSelectionMode",this).call(this,x,y)){var coord=this.getSelectedRectsCoord();coord.length&&android.onStartSelectionMode(coord)}}},{key:"changeInitialSelection",value:function(x,y){if(_get(Sel.prototype.__proto__||Object.getPrototypeOf(Sel.prototype),"changeInitialSelection",this).call(this,x,y)){var coord=this.getSelectedRectsCoord();coord.length&&android.onInitialSelectionChanged(coord)}}},{key:"expandUpperSelection",value:function(x,y){if(_get(Sel.prototype.__proto__||Object.getPrototypeOf(Sel.prototype),"expandUpperSelection",this).call(this,x,y)){var coord=this.getSelectedRectsCoord();coord.length&&android.onSelectionChanged(coord,this.getSelectedText())}}},{key:"expandLowerSelection",value:function(x,y){if(_get(Sel.prototype.__proto__||Object.getPrototypeOf(Sel.prototype),"expandLowerSelection",this).call(this,x,y)){var coord=this.getSelectedRectsCoord();coord.length&&android.onSelectionChanged(coord,this.getSelectedText())}}},{key:"requestSelectionInfo",value:function(){android.onSelectionInfo(this.getSelectedSerializedRange(),this.getSelectedText(),this.nextPageContinuable)}}]),Sel}();exports.default=Sel},{"../common/_Sel":16,"./Util":7}],6:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_TTS3=require("../common/tts/_TTS"),_TTS4=(obj=_TTS3)&&obj.__esModule?obj:{default:obj};var TTS=function(_TTS2){function TTS(){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TTS),function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,(TTS.__proto__||Object.getPrototypeOf(TTS)).apply(this,arguments))}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(TTS,_TTS4.default),_createClass(TTS,[{key:"didFinishMakePartialChunks",value:function(isMakingTemporalChunk,addAtFirst){for(;0<this.chunks.length;){var chunk=addAtFirst?this.chunks.pop():this.chunks.shift();android.onUtteranceFound(chunk.getStartNodeIndex(),chunk.getStartWordIndex(),chunk.getUtterance().text,this.reader.rectsToAbsoluteCoord(chunk.getClientRects(!0)),isMakingTemporalChunk,addAtFirst)}}},{key:"didFinishMakeChunks",value:function(){(function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;return void 0!==getter?getter.call(receiver):void 0})(TTS.prototype.__proto__||Object.getPrototypeOf(TTS.prototype),"didFinishMakeChunks",this).call(this)&&android.onFinishMakeChunks()}}]),TTS}();exports.default=TTS},{"../common/tts/_TTS":23}],7:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_Util3=require("../common/_Util"),_Util4=(obj=_Util3)&&obj.__esModule?obj:{default:obj};var Util=function(_Util2){function Util(){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Util),function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,(Util.__proto__||Object.getPrototypeOf(Util)).apply(this,arguments))}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Util,_Util4.default),_createClass(Util,null,[{key:"toast",value:function(){var message=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";android.onShowToast(message,20<message.length?1:0)}}]),Util}();(exports.default=Util).staticOverride(Util,_Util4.default,["toast"])},{"../common/_Util":17}],8:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TTSUtterance=exports.TTSUtil=exports.TTS=exports.Util=exports.Reader=exports.Context=void 0;var _Context2=_interopRequireDefault(require("./Context")),_Reader2=_interopRequireDefault(require("./Reader")),_Util2=_interopRequireDefault(require("./Util")),_TTS2=_interopRequireDefault(require("./TTS")),_TTSUtil2=_interopRequireDefault(require("../common/tts/TTSUtil")),_TTSUtterance2=_interopRequireDefault(require("../common/tts/TTSUtterance"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.Context=_Context2.default,exports.Reader=_Reader2.default,exports.Util=_Util2.default,exports.TTS=_TTS2.default,exports.TTSUtil=_TTSUtil2.default,exports.TTSUtterance=_TTSUtterance2.default,exports.default={Context:_Context2.default,Reader:_Reader2.default,Util:_Util2.default,TTS:_TTS2.default,TTSUtil:_TTSUtil2.default,TTSUtterance:_TTSUtterance2.default}},{"../common/tts/TTSUtil":21,"../common/tts/TTSUtterance":22,"./Context":2,"./Reader":4,"./TTS":6,"./Util":7}],9:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_Object4=_interopRequireDefault(require("./_Object")),_MutableClientRect2=_interopRequireDefault(require("./MutableClientRect"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Chrome=function(_Object2){function Chrome(reader){var curPage=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Chrome);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,(Chrome.__proto__||Object.getPrototypeOf(Chrome)).call(this)),chrome=((navigator.userAgent||"").match(/chrome\/[\d]+/gi)||[""])[0],version=parseInt((chrome.match(/[\d]+/g)||[""])[0],10);return isNaN(version)||(_this._version=version),_this._magic=3,_this.changedPage(curPage),_this._scrollTracked=!1,_this._scrollListener=function(){if(_this.isCursed&&!reader.context.isScrollMode){var page=reader.curPage,prevPage=_this.prevPage,pageOverflow=_this.pageOverflow,pageWeight=_this.pageWeight;prevPage<page?(pageWeight=Math.min(pageWeight+(page-prevPage),_this._magic),pageOverflow||(_this.pageOverflow=pageWeight===_this._magic)):page<prevPage&&0===(pageWeight=Math.max(pageWeight-(prevPage-page),0))&&(_this.pageOverflow=!1),_this.prevPage=page,_this.pageWeight=pageWeight}},_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Chrome,_Object4.default),_createClass(Chrome,[{key:"version",get:function(){return this._version}},{key:"isCursed",get:function(){return this.isAndroid&&(47===this.version||49<=this.version&&this.version<61&&52!==this.version)}},{key:"isAndroid",get:function(){return null!==(navigator.userAgent||"").match(/android/gi)}},{key:"pageWeight",get:function(){return this._pageWeight},set:function(pageWeight){this._pageWeight=pageWeight}},{key:"pageOverflow",get:function(){return this._pageOverflow},set:function(pageOverflow){this._pageOverflow=pageOverflow}},{key:"prevPage",get:function(){return this._prevPage},set:function(prevPage){this._prevPage=prevPage}}]),_createClass(Chrome,[{key:"changedPage",value:function(page){this.pageWeight=Math.min(page,this._magic),this.pageOverflow=this.pageWeight===this._magic,this.prevPage=page}},{key:"addScrollListenerIfNeeded",value:function(){this._scrollTracked||(this._scrollTracked=!0,window.addEventListener("scroll",this._scrollListener,!0))}},{key:"removeScrollListenerIfNeeded",value:function(){this._scrollTracked&&(this._scrollTracked=!1,window.removeEventListener("scroll",this._scrollListener,!0))}},{key:"adjustPoint",value:function(reader,x,y){var point={x:x,y:y},htmlClientWidth=reader.htmlClientWidth,bodyClientWidth=reader.bodyClientWidth,pageXOffset=reader.pageXOffset,context=reader.context;return context.isScrollMode||(this.isCursed?(point.x+=context.pageWidthUnit*this.pageWeight,this.pageOverflow&&(point.x-=context.pageGap*this._magic,htmlClientWidth-bodyClientWidth==1&&(point.x+=this._magic))):41!==this.version&&40!==this.version||(point.x+=pageXOffset)),point}},{key:"adjustRect",value:function(reader,rect){var htmlClientWidth=reader.htmlClientWidth,bodyClientWidth=reader.bodyClientWidth,context=reader.context,adjustRect=new _MutableClientRect2.default(rect);return this.isCursed&&!context.isScrollMode&&(adjustRect.left-=context.pageWidthUnit*this.pageWeight,adjustRect.right-=context.pageWidthUnit*this.pageWeight,this._pageOverflow&&(adjustRect.left+=context.pageGap*this._magic,adjustRect.right+=context.pageGap*this._magic,htmlClientWidth-bodyClientWidth==1&&(adjustRect.left-=this._magic,adjustRect.right-=this._magic))),adjustRect}}]),Chrome}();exports.default=Chrome},{"./MutableClientRect":10,"./_Object":14}],10:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var MutableClientRect=function(){function MutableClientRect(rect){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MutableClientRect),rect?(this.left=rect.left||0,this.top=rect.top||0,this.right=rect.right||0,this.bottom=rect.bottom||0,this.width=rect.width||0,this.height=rect.height||0):(this.left=0,this.top=0,this.right=0,this.bottom=0,this.width=0,this.height=0)}return _createClass(MutableClientRect,[{key:"isEmpty",get:function(){return 0===this.left&&0===this.top&&0===this.right&&0===this.bottom}}]),MutableClientRect}();exports.default=MutableClientRect},{}],11:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _slicedToArray=function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return function(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_Object4=_interopRequireDefault(require("./_Object")),_Util3=_interopRequireDefault(require("./_Util")),_MutableClientRect2=_interopRequireDefault(require("./MutableClientRect"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _Content=function(_Object2){function _Content(reader,wrapper){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,_Content);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,(_Content.__proto__||Object.getPrototypeOf(_Content)).call(this));return _this._reader=reader,_this._wrapper=wrapper,_this.updateNodes(),_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(_Content,_Object4.default),_createClass(_Content,[{key:"wrapper",get:function(){return this._wrapper}},{key:"body",get:function(){return this.wrapper.getElementsByTagName("BODY")[0]||this.wrapper}},{key:"nodes",get:function(){return this._nodes}},{key:"images",get:function(){return this.wrapper.getElementsByTagName("IMG")}}]),_createClass(_Content,[{key:"updateNodes",value:function(){this._nodes=this.fetchNodes()}},{key:"fetchNodes",value:function(){for(var shouldManualFilter=0<arguments.length&&void 0!==arguments[0]&&arguments[0],filter=function(node){return node.nodeType===Node.TEXT_NODE||node.nodeType===Node.ELEMENT_NODE&&"IMG"===node.nodeName},calledFilter=!1,walk=document.createTreeWalker(this.body,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT,shouldManualFilter?null:{acceptNode:function(node){return calledFilter=!0,filter(node)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}},!1),nodes=[],node=void 0;node=walk.nextNode();)calledFilter?nodes.push(node):filter(node)&&nodes.push(node);return nodes}},{key:"getElementId",value:function(element){var range=document.createRange();return range.selectNodeContents(element),rangy.serializeRange(range,!0,this.body)}},{key:"setHidden",value:function(hidden,any){var el=void 0;if("string"==typeof any){try{var range=rangy.deserializeRange(any,this.body);range&&(el=range.startContainer)}catch(e){}if(!el){var _document$getElements=document.getElementsByClassName(any);el=_slicedToArray(_document$getElements,1)[0]||document.getElementById(any)}}else el=any;el&&(el.style.visibility=hidden?"hidden":"")}},{key:"getRectFromElementId",value:function(id,x,y){try{var rects=rangy.deserializeRange(id,this.body).startContainer.getAdjustedClientRects(),rect=_slicedToArray(rects,1)[0];return 1===rects.length||((rect=rects.reduce(function(result,item){var mutable=result,left=item.left,right=item.right,top=item.top,height=item.height;return left<=x&&x<right?(mutable.left+=left,mutable.top+=top):0<=left&&void 0===x?(x=left,mutable.left+=left,mutable.top+=top):left<0&&(mutable.top-=height),mutable.height+=height,mutable},new _MutableClientRect2.default({width:rect.width}))).right=rect.left+rect.width,rect.bottom=rect.top+rect.height),rect}catch(e){return null}}},{key:"getImageFromPoint",value:function(x,y){var el=document.elementFromPoint(x,y);if(el&&"IMG"===el.nodeName){var id=this.getElementId(el);return{id:id,element:el,src:el.src||"null",rect:this.getRectFromElementId(id,x,y)}}return null}},{key:"getSvgFromPoint",value:function(x,y){for(var el=document.elementFromPoint(x,y);el&&"HTML"!==el.nodeName&&"BODY"!==el.nodeName;){if("svg"===el.nodeName.toLowerCase()){for(var prefix="<svg",attrs=el.attributes,i=0;i<attrs.length;i+=1){var attr=attrs[i];prefix+=" "+attr.nodeName+'="'+attr.nodeValue+'"'}prefix+=">";for(var svgEl=document.createElement("svgElement"),nodes=el.childNodes,j=0;j<nodes.length;j+=1)svgEl.appendChild(nodes[j].cloneNode(!0));var id=this.getElementId(el);return{id:id,element:el,html:""+prefix+svgEl.innerHTML+"</svg>",rect:this.getRectFromElementId(id,x,y)}}el=el.parentElement}return null}},{key:"getLinkFromElement",value:function(el){for(var target=el;target;){if(target&&"A"===target.nodeName)return{node:target,href:target.href,type:(target.attributes["epub:type"]||{value:""}).value};target=target.parentNode}return null}},{key:"reviseImage",value:function(imgEl,screenWidth,screenHeight){var compareSize=function(size1,size2){var value,intVal=parseInt(size1,10);if(!isNaN(intVal)){if(-1!==("string"==typeof(value=size1)?value.search(/%/):-1)){if(100<intVal)return 1;if(intVal<100)return-1}if(size2<intVal)return 1;if(intVal<size2)return-1}return 0},calcRate=function(){var width=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,height=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=void 0,m=void 0;return m=height<width?(n=height,width):(n=width,height),n/m*100},size=_Util3.default.getImageSize(imgEl),cssWidth="",cssHeight="";if(0===size.nWidth||0===size.nHeight)return{el:imgEl,width:cssWidth,height:cssHeight,position:"",size:size};(0<compareSize(size.sWidth,size.nWidth)||0<compareSize(size.aWidth,size.nWidth))&&(cssWidth="initial"),(0<compareSize(size.sHeight,size.nHeight)||0<compareSize(size.aHeight,size.nHeight))&&(cssHeight="initial");var rate=0;(size.nWidth>=size.nHeight!=size.dWidth>=size.dHeight||1<Math.abs(calcRate(size.nWidth,size.nHeight)-calcRate(size.dWidth,size.dHeight)))&&(cssHeight=size.dWidth>=size.dHeight&&size.dWidth<size.nWidth?(rate=calcRate(size.dWidth,size.nWidth)/100,size.dWidth<screenWidth&&Math.round(size.nHeight*rate)<screenHeight?(cssWidth=size.dWidth+"px",Math.round(size.nHeight*rate)+"px"):cssWidth="initial"):size.dWidth<size.dHeight&&size.dHeight<size.nHeight?(rate=calcRate(size.dHeight,size.nHeight)/100,Math.round(size.nWidth*rate)<screenWidth&&size.dHeight<screenHeight?(cssWidth=Math.round(size.nWidth*rate)+"px",size.dHeight+"px"):cssWidth="initial"):cssWidth="initial");var width=parseInt(cssWidth,10)||size.dWidth,height=parseInt(cssHeight,10)||size.dHeight;if(screenWidth<width||screenHeight<height){var margin=_Util3.default.getStylePropertiesIntValue(imgEl,["line-height","margin-top","margin-bottom","padding-top","padding-bottom"]),vmin=Math.min(screenWidth,screenHeight),adjustHeight=Math.max(.95*(screenHeight-margin),.95*vmin),adjustWidth=adjustHeight/size.nHeight*size.nWidth;screenWidth<adjustWidth&&(adjustHeight*=screenWidth/adjustWidth,adjustWidth=screenWidth),cssWidth=adjustWidth+"px",cssHeight=adjustHeight+"px"}return{el:imgEl,width:cssWidth,height:cssHeight,position:"",size:size}}}]),_Content}();exports.default=_Content},{"./MutableClientRect":10,"./_Object":14,"./_Util":17}],12:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_Object3=require("./_Object"),_Object4=(obj=_Object3)&&obj.__esModule?obj:{default:obj};var _Context=function(_Object2){function _Context(width,height,gap,doublePageMode,scrollMode){var maxSelectionLength=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,systemMajorVersion=6<arguments.length&&void 0!==arguments[6]?arguments[6]:0;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,_Context);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,(_Context.__proto__||Object.getPrototypeOf(_Context)).call(this));return _this._width=width,_this._height=height,_this._gap=gap,_this._doublePageMode=doublePageMode,_this._scrollMode=scrollMode,_this._maxSelectionLength=maxSelectionLength,_this._systemMajorVersion=systemMajorVersion,_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(_Context,_Object4.default),_createClass(_Context,[{key:"pageWidthUnit",get:function(){return this._width+this.pageGap}},{key:"pageHeightUnit",get:function(){return this._height}},{key:"pageGap",get:function(){return this._gap}},{key:"pageUnit",get:function(){return this.isScrollMode?this.pageHeightUnit:this.pageWidthUnit}},{key:"isDoublePageMode",get:function(){return this._doublePageMode}},{key:"isScrollMode",get:function(){return this._scrollMode}},{key:"systemMajorVersion",get:function(){return this._systemMajorVersion}},{key:"maxSelectionLength",get:function(){return this._maxSelectionLength}}]),_Context}();exports.default=_Context},{"./_Object":14}],13:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_Object3=require("./_Object"),_Object4=(obj=_Object3)&&obj.__esModule?obj:{default:obj};var _Handler=function(_Object2){function _Handler(reader){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,_Handler);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,(_Handler.__proto__||Object.getPrototypeOf(_Handler)).call(this));return _this._reader=reader,_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(_Handler,_Object4.default),_createClass(_Handler,[{key:"reader",get:function(){return this._reader}}]),_createClass(_Handler,[{key:"getLinkFromPoint",value:function(x,y){if(0===document.links.length)return null;for(var point=this.reader.adjustPoint(x,y),_x=point.x-12;_x<=point.x+12;_x+=6)for(var _y=point.y-12;_y<=point.y+12;_y+=6){var el=document.elementFromPoint(_x,_y);if(el){var link=this.reader.content.getLinkFromElement(el);if(null!==link)return link}}return null}}]),_Handler}();exports.default=_Handler},{"./_Object":14}],14:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var _Object=function(){function _Object(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,_Object)}return _createClass(_Object,null,[{key:"staticOverride",value:function(from,to,methods){var _to=to;methods.forEach(function(method){_to.prototype.constructor[method]=from.prototype.constructor[method]})}}]),_Object}();exports.default=_Object},{}],15:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_Object4=_interopRequireDefault(require("./_Object")),_Sel3=_interopRequireDefault(require("./_Sel")),_Util3=_interopRequireDefault(require("./_Util")),_MutableClientRect2=_interopRequireDefault(require("./MutableClientRect"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _Reader=function(_Object2){function _Reader(wrapper,context){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,_Reader);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,(_Reader.__proto__||Object.getPrototypeOf(_Reader)).call(this));return _this._context=context,_this.debugNodeLocation=!1,_this.setCustomMethod(),_this.setViewport(),_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(_Reader,_Object4.default),_createClass(_Reader,[{key:"content",get:function(){return this._content}},{key:"handler",get:function(){return this._handler}},{key:"sel",get:function(){return this._sel}},{key:"context",get:function(){return this._context}},{key:"totalWidth",get:function(){return this.content.wrapper.scrollWidth}},{key:"totalHeight",get:function(){return this.content.wrapper.scrollHeight}},{key:"totalSize",get:function(){return this.context.isScrollMode?this.totalHeight:this.totalWidth}},{key:"pageXOffset",get:function(){return window.pageXOffset}},{key:"pageYOffset",get:function(){return window.pageYOffset}},{key:"pageOffset",get:function(){return this.context.isScrollMode?this.pageYOffset:this.pageXOffset}},{key:"curPage",get:function(){return this.pageOffset/this.context.pageUnit}}]),_createClass(_Reader,[{key:"setCustomMethod",value:function(){var reader=this;function getAdjustedBoundingClientRect(){return reader.adjustRect(this.getBoundingClientRect()||new _MutableClientRect2.default)}function getAdjustedClientRects(){for(var rects=this.getClientRects()||[],newRects=[],i=0;i<rects.length;i+=1){var rect=rects[i];rect.width<=1||newRects.push(rect)}return reader.adjustRects(newRects)}[Range,HTMLElement,SVGElement].forEach(function(type){type.prototype.getAdjustedBoundingClientRect=getAdjustedBoundingClientRect,type.prototype.getAdjustedClientRects=getAdjustedClientRects})}},{key:"setViewport",value:function(){var value="width="+(this.context.pageWidthUnit-this.context.pageGap)+", height="+this.context.pageHeightUnit+", initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=0",viewport=document.querySelector("meta[name=viewport]");null===viewport&&((viewport=document.createElement("meta")).id="viewport",viewport.name="viewport",document.getElementsByTagName("head")[0].appendChild(viewport)),viewport.content=value}},{key:"adjustPoint",value:function(x,y){return{x:x,y:y}}},{key:"adjustRect",value:function(rect){return new _MutableClientRect2.default(rect)}},{key:"adjustRects",value:function(rects){var _this2=this;return _Util3.default.concatArray([],rects,function(rect){return _this2.adjustRect(rect)})}},{key:"changeContext",value:function(context){this._context=context}},{key:"scrollTo",value:function(offset){this.context.isScrollMode?window.scroll(0,offset):window.scroll(offset,0)}},{key:"getOffsetDirectionFromElement",value:function(el){var direction=this.context.isScrollMode?"top":"left";if(el){var position=_Util3.default.getMatchedCSSValue(el,"position",!0);"left"===direction&&"absolute"===position&&(direction="top")}return direction}},{key:"_getOffsetFromAnchor",value:function(anchor,block){var el=document.getElementById(anchor);if(el){var node=_Util3.default.createTextNodeIterator(el).nextNode();if(node){var range=document.createRange();range.selectNodeContents(node);var display=window.getComputedStyle(el).display,rects=range.getAdjustedClientRects();if(rects.length)return block(rects[0],el);if("none"===display){el.style.display="block";var rect=el.getAdjustedBoundingClientRect();return el.style.display="none",block(rect,el)}}return block(el.getAdjustedBoundingClientRect(),el)}return block({left:null,top:null},null)}},{key:"getOffsetFromAnchor",value:function(anchor){var _this3=this;return this._getOffsetFromAnchor(anchor,function(rect,el){return _this3.context.isScrollMode?null===rect.top?null:rect.top+_this3.pageYOffset:null===rect.left?null:_this3.getPageFromRect(rect,el)})}},{key:"getOffsetFromSerializedRange",value:function(serializedRange){try{var rects=this.getRangeFromSerializedRange(serializedRange).getAdjustedClientRects();return 0<rects.length?this.context.isScrollMode?rects[0].top+this.pageYOffset:this.getPageFromRect(rects[0]):null}catch(e){return null}}},{key:"_findRectIndex",value:function(rects,startOffset,endOffset){for(var type=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"top",origin=this.context.isScrollMode?"top":"left",j=0;j<rects.length;j+=1){var rect=rects[j];if("bottom"===type){if(endOffset<=rect[origin]&&0<rect.width)return j-1}else if(startOffset<=rect[origin]&&rect[origin]<=endOffset&&0<rect.width)return j}return null}},{key:"findNodeLocation",value:function(startOffset,endOffset){var type=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"top",posSeparator=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"#";this._latestNodeRect=null;var nodes=this.content.nodes;if(!nodes)return null;for(var prev=null,i=0;i<nodes.length;i+=1){var node=nodes[i],range=document.createRange();range.selectNodeContents(node);var rect=range.getAdjustedBoundingClientRect();if(rect.isEmpty){if("IMG"!==node.nodeName)continue;if(range.selectNode(node),(rect=range.getAdjustedBoundingClientRect()).isEmpty)continue}var origin=this.context.isScrollMode?rect.top+rect.height:rect.left+rect.width;if(!(0===rect.width||origin<startOffset)){var rectIndex=void 0;if(node.nodeType===Node.TEXT_NODE){var string=node.nodeValue;if(!string)continue;for(var words=string.split(_Util3.default.getSplitWordRegex()),offset=range.startOffset,j=0;j<words.length;j+=1){var word=words[j];if(word.trim().length){try{range.setStart(node,offset),range.setEnd(node,offset+word.length)}catch(e){return null}var rects=range.getAdjustedClientRects();if(null!==(rectIndex=this._findRectIndex(rects,startOffset,endOffset,type)))return rectIndex<0?(this._latestNodeRect=prev.rect,prev.location):(this._latestNodeRect=rects[rectIndex],i+posSeparator+Math.min(j+rectIndex,words.length-1));for(var k=rects.length-1;0<=k;k-=1)rects[k].left<endOffset&&(prev={location:""+i+posSeparator+j,rect:rects[k]})}offset+=word.length+1}}else if("IMG"===node.nodeName){var _rects=range.getAdjustedClientRects();if(null!==(rectIndex=this._findRectIndex(_rects,startOffset,endOffset,type)))return rectIndex<0?(this._latestNodeRect=prev.rect,prev.location):(this._latestNodeRect=_rects[rectIndex],""+i+posSeparator+"0");for(var _k=_rects.length-1;0<=_k;_k-=1)_rects[_k].left<endOffset&&(prev={location:""+i+posSeparator+"0",rect:_rects[_k]})}}}return null}},{key:"showNodeLocationIfNeeded",value:function(){if(this.debugNodeLocation&&null!==this._latestNodeRect){var span=document.getElementById("RidiNodeLocation");span||((span=document.createElement("span")).setAttribute("id","RidiNodeLocation"),document.body.appendChild(span));var rect=this._latestNodeRect;rect[this.context.isScrollMode?"top":"left"]+=this.pageOffset,span.style.cssText="position: absolute !important;background-color: red !important;left: "+rect.left+"px !important;top: "+rect.top+"px !important;width: "+(rect.width||3)+"px !important;height: "+rect.height+"px !important;display: block !important;opacity: 0.4 !important;z-index: 99 !important;"}}},{key:"getOffsetFromNodeLocation",value:function(location){var type=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"top",posSeparator=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"#",parts=location.split(posSeparator),nodeIndex=parseInt(parts[0],10),wordIndex=parseInt(parts[1],10),_context=this.context,pageUnit=_context.pageUnit,isScrollMode=_context.isScrollMode,totalSize=this.totalSize,nodes=this.content.nodes;if(-1===nodeIndex||-1===wordIndex||null===nodes)return null;var node=nodes[nodeIndex];if(!node)return null;var range=document.createRange();range.selectNodeContents(node);var rect=range.getAdjustedBoundingClientRect();if(rect.isEmpty){if("IMG"!==node.nodeName)return null;if(range.selectNode(node),(rect=range.getAdjustedBoundingClientRect()).isEmpty)return null}var page=this.getPageFromRect(rect);if(null===page||totalSize<=pageUnit*page)return null;if("IMG"===node.nodeName&&0===wordIndex)return isScrollMode?Math.max(rect.top+this.pageYOffset-("bottom"===type?pageUnit:0),0):page;var string=node.nodeValue;if(null===string)return null;for(var words=string.split(_Util3.default.getSplitWordRegex()),word=void 0,offset=0,i=0;i<=Math.min(wordIndex,words.length-1);i+=1)offset+=(word=words[i]).length+1;try{range.setStart(range.startContainer,offset-word.length-1),range.setEnd(range.startContainer,offset-1)}catch(e){return null}return rect=range.getAdjustedBoundingClientRect(),null===(page=this.getPageFromRect(rect))||totalSize<=pageUnit*page?null:((rect.left<0||(page+1)*pageUnit<rect.left+rect.width)&&(rect.width<pageUnit?page+=1:page+=Math.floor(rect.width/pageUnit)),isScrollMode?Math.max(rect.top+this.pageYOffset-("bottom"===type?pageUnit:0),0):page)}},{key:"searchText",value:function(keyword){return window.find(keyword,0)?rangy.serializeRange(getSelection().getRangeAt(0),!0,this.content.body):"null"}},{key:"textAroundSearchResult",value:function(pre,post){var range=getSelection().getRangeAt(0),start=range.startOffset,newStart=Math.max(range.startOffset-pre,0),end=range.endOffset,newEnd=Math.min(newStart+post,range.endContainer.length);range.setStart(range.startContainer,newStart),range.setEnd(range.endContainer,newEnd);var result=range.toString();return range.setStart(range.startContainer,start),range.setEnd(range.endContainer,end),result}},{key:"getRectsOfSearchResult",value:function(){return getSelection().getRangeAt(0).getAdjustedClientRects()}},{key:"getPageOfSearchResult",value:function(){var rects=this.getRectsOfSearchResult();return this.getPageFromRect(rects[0])}},{key:"getRangeFromSerializedRange",value:function(serializedRange){var tmpRange=rangy.deserializeRange(serializedRange,this.content.body),range=document.createRange();return range.setStart(tmpRange.startContainer,tmpRange.startOffset),range.setEnd(tmpRange.endContainer,tmpRange.endOffset),tmpRange.detach(),range}},{key:"getRectsFromSerializedRange",value:function(serializedRange){var range=this.getRangeFromSerializedRange(serializedRange);return _Sel3.default.getOnlyTextNodeRectsFromRange(range)}},{key:"rectToAbsolute",value:function(rect){var mutableRect=rect;return this.context.isScrollMode?mutableRect.top+=this.pageYOffset:mutableRect.left+=this.pageXOffset,mutableRect}},{key:"_rectsToCoord",value:function(rects){var insets={left:0,top:0};1<arguments.length&&void 0!==arguments[1]&&arguments[1]&&(this.context.isScrollMode?insets.top=this.pageYOffset:insets.left=this.pageXOffset);for(var result="",i=0;i<rects.length;i+=1){var rect=rects[i];result+=rect.left+insets.left+",",result+=rect.top+insets.top+",",result+=rect.width+",",result+=rect.height+","}return result}},{key:"rectsToAbsoluteCoord",value:function(rects){return this._rectsToCoord(rects,!0)}},{key:"rectsToRelativeCoord",value:function(rects){return this._rectsToCoord(rects)}}]),_Reader}();exports.default=_Reader},{"./MutableClientRect":10,"./_Object":14,"./_Sel":16,"./_Util":17}],16:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_Object4=_interopRequireDefault(require("./_Object")),_Util3=_interopRequireDefault(require("./_Util")),_TTSUtil2=_interopRequireDefault(require("./tts/TTSUtil"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _Sel=function(_Object2){function _Sel(reader){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,_Sel);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,(_Sel.__proto__||Object.getPrototypeOf(_Sel)).call(this));return _this._reader=reader,_this._maxLength=reader.context.maxSelectionLength,_this._startContainer=null,_this._startOffset=null,_this._endContainer=null,_this._endOffset=null,_this._overflowed=!1,_this._nextPageContinuable=!1,_this._continueContainer=null,_this._continueOffset=null,_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(_Sel,_Object4.default),_createClass(_Sel,[{key:"reader",get:function(){return this._reader}},{key:"nextPageContinuable",get:function(){return this._checkNextPageContinuable(this.getSelectedRange())}}]),_createClass(_Sel,[{key:"_caretRangeFromPoint",value:function(x,y){var unit=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"word",allowCollapsed=3<arguments.length&&void 0!==arguments[3]&&arguments[3],point=this.reader.adjustPoint(x,y),range=document.caretRangeFromPoint(point.x,point.y);return null===range?null:(range.expand(unit),!allowCollapsed&&range.collapsed?null:range)}},{key:"_expandRangeByWord",value:function(range){var startContainer=range.startContainer;if(null!==startContainer.nodeValue){var tables=[_TTSUtil2.default.chineseCodeTable(),_TTSUtil2.default.japaneseCodeTable()];if(_TTSUtil2.default.getContainCharRegex(tables).test(range.toString()))range.expand("character");else{for(var containerValueLength=startContainer.nodeValue.length,start=range.startOffset,origin=start;0<start;){if(/^\s/.test(range.toString())){range.setStart(startContainer,start+=1);break}start-=1,range.setStart(startContainer,start)}for(;origin<containerValueLength;){if(/\s$/.test(range.toString())){range.setEnd(startContainer,origin-=1);break}origin+=1,range.setEnd(startContainer,origin)}}}}},{key:"isOutOfBounds",value:function(){return!1}},{key:"startSelectionMode",value:function(x,y,unit){var range=this._caretRangeFromPoint(x,y,unit);return null!==range&&(this._expandRangeByWord(range),this._startContainer=range.startContainer,this._startOffset=range.startOffset,this._endContainer=range.endContainer,this._endOffset=range.endOffset,!0)}},{key:"changeInitialSelection",value:function(x,y,unit){var range=this._caretRangeFromPoint(x,y,unit);return null!==range&&(this._startContainer=range.startContainer,this._startOffset=range.startOffset,this._endContainer=range.endContainer,this._endOffset=range.endOffset,!0)}},{key:"expandUpperSelection",value:function(x,y){var unit=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"character",exRange=this._caretRangeFromPoint(x,y,unit,!0);if(null===exRange)return!1;var containerDiff=this._endContainer.compareDocumentPosition(exRange.startContainer);if(containerDiff===Node.DOCUMENT_POSITION_FOLLOWING||0===containerDiff&&this._endOffset<exRange.startOffset)return!1;if(exRange.startContainer===this._startContainer&&exRange.startOffset===this._startOffset)return!1;exRange.startContainer.childNodes.length&&exRange.setStart(exRange.startContainer.childNodes[exRange.startOffset],0),exRange.endContainer.childNodes.length&&exRange.setEnd(exRange.endContainer.childNodes[exRange.endOffset],exRange.endContainer.childNodes[exRange.endOffset].textContent.length);var range=document.createRange();return range.setStart(exRange.startContainer,exRange.startOffset),range.setEnd(this._endContainer,this._endOffset),!range.collapsed&&(!!this.validLength(range)&&(this._startContainer=exRange.startContainer,this._startOffset=exRange.startOffset,!0))}},{key:"expandLowerSelection",value:function(x,y){var unit=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"character",exRange=this._caretRangeFromPoint(x,y,unit,!0);if(null===exRange)return!1;var containerDiff=this._startContainer.compareDocumentPosition(exRange.endContainer);if(containerDiff===Node.DOCUMENT_POSITION_PRECEDING||0===containerDiff&&this._startOffset>exRange.endOffset)return!1;if(exRange.endContainer===this._endContainer&&exRange.endOffset===this._endOffset)return!1;if(exRange.startContainer.childNodes.length&&exRange.setStart(exRange.startContainer.childNodes[exRange.startOffset],0),exRange.endContainer.childNodes.length&&exRange.setEnd(exRange.endContainer.childNodes[exRange.endOffset],exRange.endContainer.childNodes[exRange.endOffset].textContent.length),this.isOutOfBounds(exRange))return!1;var range=document.createRange();return range.setStart(this._startContainer,this._startOffset),range.setEnd(exRange.endContainer,exRange.endOffset),!range.collapsed&&(!!this.validLength(range)&&(this._endContainer=exRange.endContainer,this._endOffset=exRange.endOffset,!0))}},{key:"_clientLeftOfRangeForCheckingNextPageContinuable",value:function(range){var rect=range.getAdjustedBoundingClientRect();return Math.floor(rect.left+rect.width)}},{key:"_checkNextPageContinuable",value:function(range){if(!this.reader.context.isScrollMode){var upperBound=this.getUpperBound(),clonedRange=range.cloneRange(),node=clonedRange.endContainer,end=clonedRange.endOffset;do{for(var length=node.textContent.length;end<length;){if(clonedRange.setStart(node,end),clonedRange.setEnd(node,end+1),!/\s/.test(clonedRange.toString()))return this._clientLeftOfRangeForCheckingNextPageContinuable(clonedRange)<upperBound?this._nextPageContinuable=!1:(this._expandRangeBySentenceInPage(clonedRange,2*upperBound),this._continueContainer=clonedRange.endContainer,this._continueOffset=clonedRange.endOffset,this._nextPageContinuable=!0),this._nextPageContinuable;end+=1}end=0,this._nextPageContinuable=!1}while(node=this._getNextTextNode(clonedRange))}return this._nextPageContinuable}},{key:"_expandRangeBySentenceInPage",value:function(range,upperBound){var origin=range.endOffset;range.expand("sentence");for(var end=range.endOffset;origin<end;)if(/\s$/.test(range.toString()))range.setEnd(range.endContainer,end-=1);else{if(range.getAdjustedBoundingClientRect().right<=upperBound)break;range.setEnd(range.endContainer,end-=1)}}},{key:"_getNextTextNode",value:function(range){var nextNode=range.endContainer.nextSibling;if(nextNode){if(nextNode.nodeType===Node.TEXT_NODE)return nextNode;var textNode=_Util3.default.createTextNodeIterator(nextNode).nextNode();return textNode||(range.setEnd(nextNode,0),this._getNextTextNode(range))}return range.setEndAfter(range.endContainer),"BODY"===range.endContainer.nodeName?null:this._getNextTextNode(range)}},{key:"expandSelectionIntoNextPage",value:function(){return!!this._nextPageContinuable&&(this._endContainer=this._continueContainer,this._endOffset=this._continueOffset,!(this._nextPageContinuable=!1))}},{key:"validLength",value:function(range){return range.toString().length<=this._maxLength||(this._overflowed||_Util3.default.toast("최대 "+this._maxLength+"자까지 선택할 수 있습니다."),!(this._overflowed=!0))}},{key:"getSelectedRange",value:function(){var range=document.createRange();return range.setStart(this._startContainer,this._startOffset),range.setEnd(this._endContainer,this._endOffset),range}},{key:"getSelectedSerializedRange",value:function(){return rangy.serializeRange(this.getSelectedRange(),!0,this.reader.content.body)}},{key:"getSelectedRangeRects",value:function(){return _Sel.getOnlyTextNodeRectsFromRange(this.getSelectedRange())}},{key:"getSelectedText",value:function(){return this.getSelectedRange().toString()}},{key:"getSelectedRectsCoord",value:function(){var rects=this.getSelectedRangeRects();return rects.length?(this._overflowed=!1,this.reader.rectsToAbsoluteCoord(rects)):""}}],[{key:"_isWhiteSpaceRange",value:function(range){return/^\s*$/.test(range.toString())}},{key:"getOnlyTextNodeRectsFromRange",value:function(range){if(range.startContainer===range.endContainer){var innerText=range.startContainer.innerText;return void 0!==innerText&&0===innerText.length?[]:range.getAdjustedClientRects()}var iterator=_Util3.default.createTextNodeIterator(range.commonAncestorContainer),textNodeRects=[],workRange=document.createRange();workRange.setStart(range.startContainer,range.startOffset),workRange.setEnd(range.startContainer,range.startContainer.length),textNodeRects=_Util3.default.concatArray(textNodeRects,workRange.getAdjustedClientRects());for(var node=void 0;node=iterator.nextNode();)if(range.startContainer.compareDocumentPosition(node)!==Node.DOCUMENT_POSITION_PRECEDING&&range.startContainer!==node){if(range.endContainer.compareDocumentPosition(node)===Node.DOCUMENT_POSITION_FOLLOWING||range.endContainer===node)break;(workRange=document.createRange()).selectNodeContents(node),this._isWhiteSpaceRange(workRange)||(textNodeRects=_Util3.default.concatArray(textNodeRects,workRange.getAdjustedClientRects()))}return(workRange=document.createRange()).setStart(range.endContainer,0),workRange.setEnd(range.endContainer,range.endOffset),this._isWhiteSpaceRange(workRange)||(textNodeRects=_Util3.default.concatArray(textNodeRects,workRange.getAdjustedClientRects())),textNodeRects}}]),_Sel}();exports.default=_Sel},{"./_Object":14,"./_Util":17,"./tts/TTSUtil":21}],17:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_Object3=require("./_Object"),_Object4=(obj=_Object3)&&obj.__esModule?obj:{default:obj};var _Util=function(_Object2){function _Util(){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,_Util),function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,(_Util.__proto__||Object.getPrototypeOf(_Util)).apply(this,arguments))}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(_Util,_Object4.default),_createClass(_Util,null,[{key:"createTextNodeIterator",value:function(node){return document.createNodeIterator(node,NodeFilter.SHOW_TEXT,{acceptNode:function(){return NodeFilter.FILTER_ACCEPT}},!0)}},{key:"getFootnoteRegex",value:function(){return/^(\[|\{|\(|주|)[0-9].*(\)|\}|\]|\.|)$/gm}},{key:"getSplitWordRegex",value:function(){return new RegExp(" |\\u00A0")}},{key:"getImageSize",value:function(imgEl){var attrs=imgEl.attributes,zeroAttr=document.createAttribute("size");return zeroAttr.value="0px",{dWidth:imgEl.width,dHeight:imgEl.height,nWidth:imgEl.naturalWidth,nHeight:imgEl.naturalHeight,sWidth:_Util.getMatchedCSSValue(imgEl,"width"),sHeight:_Util.getMatchedCSSValue(imgEl,"height"),aWidth:(attrs.width||zeroAttr).value,aHeight:(attrs.height||zeroAttr).value}}},{key:"getStylePropertyIntValue",value:function(target,property){var style=target;return target.nodeType&&(style=window.getComputedStyle(target)),parseInt(style[property],10)||0}},{key:"getStylePropertiesIntValue",value:function(target,properties){var style=target;target.nodeType&&(style=window.getComputedStyle(target));for(var value=0,i=0;i<properties.length;i+=1)value+=parseInt(style[properties[i]],10)||0;return value}},{key:"_getMatchedCSSValue",value:function(el,property){var val=el.style.getPropertyValue(property);if(el.style.getPropertyPriority(property))return val;var rules=void 0;try{if(null===(rules=window.getMatchedCSSRules(el)))return val}catch(e){return val}for(var i=rules.length-1;0<=i;i-=1){var rule=rules[i],important=rule.style.getPropertyPriority(property);if((null===val||0===val.length||important)&&(val=rule.style.getPropertyValue(property),important))break}return val}},{key:"getMatchedCSSValue",value:function(el,property){for(var recursive=2<arguments.length&&void 0!==arguments[2]&&arguments[2],val=void 0,target=el;!(val=this._getMatchedCSSValue(target,property))&&null!==(target=target.parentElement)&&recursive;);return val}},{key:"concatArray",value:function(array,rects){for(var adjust=2<arguments.length&&void 0!==arguments[2]?arguments[2]:function(rect){return rect},i=0;i<rects.length;i+=1)array.push(adjust(rects[i]));return array}}]),_Util}();exports.default=_Util},{"./_Object":14}],18:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_TTSRange2=_interopRequireDefault(require("./TTSRange")),_TTSUtterance2=_interopRequireDefault(require("./TTSUtterance")),_TTSUtil2=_interopRequireDefault(require("./TTSUtil")),_Util3=_interopRequireDefault(require("../_Util"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var TTSChunk=function(){function TTSChunk(pieces){var range=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TTSChunk),this._pieces=pieces,this.range=range}return _createClass(TTSChunk,[{key:"range",get:function(){return this._range},set:function(newRange){newRange instanceof _TTSRange2.default?this._range=newRange:this._range=new _TTSRange2.default(0,this._getFullText().length)}}]),_createClass(TTSChunk,[{key:"toJSONForNative",value:function(reader){return{nodeIndex:this.getStartNodeIndex(),wordIndex:this.getStartWordIndex(),text:this.getUtterance().text,rects:reader.rectsToAbsoluteCoord(this.getClientRects(!0))}}},{key:"_getFullText",value:function(){var fullText="";return this._pieces.forEach(function(piece){fullText+=piece.text}),fullText}},{key:"getText",value:function(){return this._getFullText().substring(this.range.startOffset,this.range.endOffset)}},{key:"getUtterance",value:function(){return new _TTSUtterance2.default(this.getText()).removeNewLine().removeSpecialCharacters(["≪","≫"]).removeHanja().removeLatin().removeAllRepeatedCharacter(["<",">","_","×"]).replaceTilde().replaceNumeric().replaceBracket().replaceEqual().replaceDate().insertPauseTag()}},{key:"getPiece",value:function(offset){var length=0;return _TTSUtil2.default.find(this._pieces,function(piece){return length+=piece.length,offset<=length})}},{key:"getOffset",value:function(piece){var offset=piece.paddingLeft;return void 0!==this._pieces.find(function(item){return item===piece||(offset+=item.length,!1)})?offset:0}},{key:"getStartWordPiece",value:function(){return this.getPiece(this.range.startOffset)}},{key:"getEndWordPiece",value:function(){return this.getPiece(this.range.endOffset)}},{key:"getStartNodeIndex",value:function(){return this.getStartWordPiece().nodeIndex}},{key:"getEndNodeIndex",value:function(){return this.getEndWordPiece().nodeIndex}},{key:"getStartWordIndex",value:function(){for(var piece=this.getStartWordPiece(),offsetBeforeNode=0,i=0;i<this._pieces.length;i+=1){var currentPiece=this._pieces[i];if(currentPiece.nodeIndex>=piece.nodeIndex)break;offsetBeforeNode+=currentPiece.length,0===i&&(offsetBeforeNode+=currentPiece.paddingLeft)}var offsetBeforeWordInNode=this.range.startOffset+this._pieces[0].paddingLeft-offsetBeforeNode;if(offsetBeforeWordInNode<=0)return 0;for(var words=(piece.node.nodeValue||"").split(_TTSUtil2.default.getSplitWordRegex()),currentWordStartOffset=0,j=0;j<words.length;j+=1){if(offsetBeforeWordInNode<=currentWordStartOffset)return j;currentWordStartOffset+=words[j].length+1}return words.length-1}},{key:"getEndWordIndex",value:function(){for(var piece=this.getEndWordPiece(),firstPaddingLeft=this._pieces[0].paddingLeft,offsetBeforeNode=0,i=0;i<this._pieces.length;i+=1){var currentPiece=this._pieces[i];if(currentPiece.nodeIndex>=piece.nodeIndex)break;offsetBeforeNode+=currentPiece.length,0===i&&(offsetBeforeNode+=firstPaddingLeft)}for(var offsetAfterEndWordInNode=this.range.endOffset+firstPaddingLeft-offsetBeforeNode,words=(piece.node.nodeValue||"").split(_TTSUtil2.default.getSplitWordRegex()),currentWordEndOffset=0,j=0;j<words.length;j+=1)if(offsetAfterEndWordInNode<=(currentWordEndOffset+=words[j].length+1))return j;return words.length-1}},{key:"getClientRects",value:function(removeBlank){for(var chunkRange=this.range,pieces=this._pieces,rects=[],start=0,end=0,current=0,totalLength=0,i=0;i<pieces.length;i+=1,current+=totalLength){var piece=pieces[i],node=piece.node,range=document.createRange();if(range.selectNodeContents(node),piece.isInvalid())totalLength=0,rects.push(range.getAdjustedBoundingClientRect());else{totalLength=piece.length;var pieceRange=new _TTSRange2.default(current,current+piece.length);if(chunkRange.startOffset<=pieceRange.startOffset)if(pieceRange.endOffset<=chunkRange.endOffset)start=pieceRange.startOffset,end=pieceRange.endOffset;else{if(chunkRange.endOffset<=pieceRange.startOffset)continue;start=pieceRange.startOffset,end=chunkRange.endOffset}else if(chunkRange.endOffset<=pieceRange.endOffset)start=chunkRange.startOffset,end=chunkRange.endOffset;else{if(pieceRange.endOffset<=chunkRange.startOffset)continue;start=chunkRange.startOffset,end=pieceRange.endOffset}start=Math.max(start-current+piece.paddingLeft,0),0===(end=Math.max(end-current+piece.paddingLeft,0))&&(end=totalLength);try{range.setStart(node,start),range.setEnd(node,end),range.expand("character")}catch(e){console.error("TSChunk:getClientRects() Error!! "+e.toString()+"\n => {startOffset: "+start+", endOffset: "+end+", offset: "+current+", nodeIndex: "+piece.nodeIndex+", startWordIndex: "+piece.startWordIndex+", endWordIndex: "+piece.endWordIndex+"}")}if(!0===removeBlank&&0===range.toString().length)continue;rects=_Util3.default.concatArray(rects,range.getAdjustedClientRects())}}return rects}},{key:"copy",value:function(range){return new TTSChunk(this._pieces,range)}}]),TTSChunk}();exports.default=TTSChunk},{"../_Util":17,"./TTSRange":20,"./TTSUtil":21,"./TTSUtterance":22}],19:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_TTSUtil2=_interopRequireDefault(require("./TTSUtil")),_Util3=_interopRequireDefault(require("../_Util"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var TTSPiece=function(){function TTSPiece(node,nodeIndex){var _this=this,startWordIndex=2<arguments.length&&void 0!==arguments[2]?arguments[2]:-1,endWordIndex=3<arguments.length&&void 0!==arguments[3]?arguments[3]:-1;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TTSPiece),this._node=node,this._nodeIndex=nodeIndex;var nodeValue=this._node.nodeValue;if(this._paddingLeft=0,this._paddingRight=0,this._text="",this._startWordIndex=-1,this._endWordIndex=-1,"string"==typeof nodeValue)if(startWordIndex<0&&endWordIndex<0)this._text=nodeValue;else{var words=nodeValue.split(_TTSUtil2.default.getSplitWordRegex());if(startWordIndex>=words.length||endWordIndex>=words.length)throw new Error("TTSPiece: wordIndex is out of bounds - startWordIndex: ("+startWordIndex+"/"+(words.length-1)+"), endWordIndex: ("+endWordIndex+"/"+(words.length-1)+").");this._startWordIndex=startWordIndex<0?0:startWordIndex,this._endWordIndex=endWordIndex<0?words.length-1:endWordIndex,words.forEach(function(word,i,list){i>=_this._startWordIndex&&i<=_this._endWordIndex?_this._text+=word+(i===list.length-1||i===_this._endWordIndex?"":" "):i<_this._startWordIndex?_this._paddingLeft+=word.length+1:_this._paddingRight+=word.length+1})}else"IMG"===this._node.nodeName&&(this._text=this._node.alt||"");this._length=this._text.length}return _createClass(TTSPiece,[{key:"nodeIndex",get:function(){return this._nodeIndex}},{key:"startWordIndex",get:function(){return this._startWordIndex}},{key:"endWordIndex",get:function(){return this._endWordIndex}},{key:"node",get:function(){return this._node}},{key:"text",get:function(){return this._text}},{key:"length",get:function(){return this._length}},{key:"paddingLeft",get:function(){return this._paddingLeft}},{key:"paddingRight",get:function(){return this._paddingRight}}]),_createClass(TTSPiece,[{key:"isInvalid",value:function(){var node=this._node,el=node.nodeType===Node.TEXT_NODE?node.parentElement:node,readable=(el.attributes["data-ridi-tts"]||{value:""}).value.toLowerCase(),valid=!0;if(0===this.length||"no"===readable)valid=!1;else if("yes"!==readable)if("none"===_Util3.default.getMatchedCSSValue(el,"display")||"hidden"===_Util3.default.getMatchedCSSValue(el,"visibility"))valid=!1;else do{if("A"===el.nodeName&&null!==this._text.match(_Util3.default.getFootnoteRegex())){valid=!1;break}if(!(valid=-1===["RT","RP","SUB","SUP","IMG"].indexOf(el.nodeName)))break}while(el=el.parentNode);return!valid}},{key:"isSiblingBrRecursive",value:function(){for(var checkNextSibling=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],node=this._node;node;){for(var sibling=node[checkNextSibling?"nextSibling":"previousSibling"];sibling;){if("BR"===sibling.nodeName)return!0;var nodes=sibling.childNodes;if(!(0<nodes.length))return!1;sibling=nodes[checkNextSibling?0:nodes.length-1]}node=node.parentNode}return!1}},{key:"isOnlyWhitespace",value:function(){var pNode=this._node.previousSibling,regex=_TTSUtil2.default.getWhitespaceAndNewLineRegex(null,"{"+this.length+",}"),only=null!==this.text.match(regex);return only&&(only="SPAN"!==this._node.parentElement.nodeName,null!==pNode&&(only="SPAN"!==pNode.nodeName)),only}},{key:"isSentence",value:function(){return null!==this.text.trim().match(_TTSUtil2.default.getSentenceRegex(null,"$"))}}]),TTSPiece}();exports.default=TTSPiece},{"../_Util":17,"./TTSUtil":21}],20:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var TTSRange=function(){function TTSRange(startOffset,endOffset){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TTSRange),this._startOffset=startOffset,this._endOffset=endOffset}return _createClass(TTSRange,[{key:"startOffset",get:function(){return this._startOffset}},{key:"endOffset",get:function(){return this._endOffset}}]),TTSRange}();exports.default=TTSRange},{}],21:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_Util2=require("../_Util"),_Util3=(obj=_Util2)&&obj.__esModule?obj:{default:obj};var TTSUtil=function(){function TTSUtil(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TTSUtil)}return _createClass(TTSUtil,null,[{key:"find",value:function(list,callback){for(var i=0;i<list.length;i+=1){var item=list[i];if(callback(item))return item}return null}},{key:"_createRegex",value:function(prefix,pattern,suffix,flags){return new RegExp(""+(prefix||"")+(pattern||"")+(suffix||""),flags||"gm")}},{key:"getSplitWordRegex",value:function(){return _Util3.default.getSplitWordRegex()}},{key:"getWhitespaceRegex",value:function(prefix,suffix,flags){return this._createRegex(prefix,"[ \\u00A0]",suffix,flags)}},{key:"getNewLineRegex",value:function(prefix,suffix,flags){return this._createRegex(prefix,"[\\r\\n]",suffix,flags)}},{key:"getWhitespaceAndNewLineRegex",value:function(prefix,suffix,flags){return this._createRegex(prefix,"[\\t\\r\\n\\s\\u00A0]",suffix,flags)}},{key:"getSentenceRegex",value:function(prefix,suffix,flags){return this._createRegex(prefix,"[.。?!\"”'’」』〞〟]",suffix,flags)}},{key:"isLastCharOfSentence",value:function(){return null!==(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"").match(this.getSentenceRegex())}},{key:"isDigitOrLatin",value:function(){var code=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"").charCodeAt(0);return this.isLatinCharCode(code)||this.isDigitCharCode(code)}},{key:"isPeriodPointOrName",value:function(textWithPeriod,textAfterPeriod){if(void 0===textWithPeriod||void 0===textAfterPeriod)return!1;var hit=0,index=textWithPeriod.search(/[.](\s{0,})$/gm);return 0<index&&this.isDigitOrLatin(textWithPeriod[index-1])&&(hit+=1),0<=(index=textAfterPeriod.search(/[^\s]/gm))&&this.isDigitOrLatin(textAfterPeriod[index])&&(hit+=1),2===hit}},{key:"getBrackets",value:function(){var text=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";try{return text.match(/[\(\)\{\}\[\]]/gm)||[]}catch(e){return[]}}},{key:"isOnePairBracket",value:function(){return null!==((0<arguments.length&&void 0!==arguments[0]?arguments[0]:"")+(1<arguments.length&&void 0!==arguments[1]?arguments[1]:"")).match(/\(\)|\{\}|\[\]/gm)}},{key:"mergeSentencesWithinBrackets",value:function(){var _this=this,sentences=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],resultSentences=[],brackets=[];return sentences.forEach(function(sentence){var didBracketsExist=0<brackets.length;_this.getBrackets(sentence).forEach(function(newBracket){var lastBracket=brackets.pop();lastBracket?_this.isOnePairBracket(lastBracket,newBracket)||(brackets.push(lastBracket),brackets.push(newBracket)):brackets.push(newBracket)}),resultSentences.push((didBracketsExist?resultSentences.pop():"")+sentence)}),0<brackets.length&&(console.error("Brackets does not match."),console.error({sentences:sentences,brackets:brackets,resultSentences:resultSentences})),resultSentences}},{key:"_containCharCode",value:function(code,table){if(!isNaN(code))for(var i=0;i<table.length;i+=2)if(table[i]<=code&&code<=table[i+1])return!0;return!1}},{key:"isDigitCharCode",value:function(code){return this._containCharCode(code,[48,57])}},{key:"isSpaceCharCode",value:function(code){return 32===code||160===code}},{key:"isTildeCharCode",value:function(code){return 126===code||8764===code||12316===code}},{key:"isColonCharCode",value:function(code){return 58===code}},{key:"hangulCodeTable",value:function(){return[44032,55215]}},{key:"isHangulCharCode",value:function(code){return this._containCharCode(code,this.hangulCodeTable())}},{key:"latinCodeTable",value:function(){return[32,127,160,255,256,383,384,591]}},{key:"isLatinCharCode",value:function(code,flag){if(isNaN(code))return!1;if(256<=code&&code<=383){if("u"===flag){if(256<=code&&code<=311&&code%2==0||330<=code&&code<=375&&code%2==0||313<=code&&code<=328&&code%2==1||377<=code&&code<=382&&code%2==1)return!0;if(376===code)return!0}else if("l"===flag){if(256<=code&&code<=311&&code%2==1||330<=code&&code<=375&&code%2==1||313<=code&&code<=328&&code%2==0||377<=code&&code<=382&&code%2==0)return!0;if(312===code||329===code||383===code)return!0}return!1}if(384<=code&&code<=591)return!0;var uppercaseTable=[65,90,192,214,216,222],lowercaseTable=[97,122,223,246,248,255],table=void 0;return table="u"===flag?uppercaseTable:"l"===flag?lowercaseTable:[].concat(uppercaseTable).concat(lowercaseTable),this._containCharCode(code,table)}},{key:"chineseCodeTable",value:function(){return[19968,40959,63744,64255,13056,13311,13312,19903,131072,173791,173824,177983,177984,178207,178208,183983,183984,191471,194560,195103]}},{key:"isChineseCharCode",value:function(code){return this._containCharCode(code,this.chineseCodeTable())}},{key:"japaneseCodeTable",value:function(){return[12288,12351,12352,12447,12448,12543,65280,65519,19968,40959]}},{key:"isJapaneseCharCode",value:function(code){return this._containCharCode(code,this.japaneseCodeTable())}},{key:"getContainCharRegex",value:function(){var tables=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],toUnicode=function(num){return 65535<num?null:String.fromCharCode(num)},string="[";return tables.forEach(function(table){for(var i=0;i<table.length;i+=2){var lower=toUnicode(table[i]),upper=toUnicode(table[i+1]);lower&&upper&&(string+=lower+"-"+upper)}}),string+="]",new RegExp("^"+string+"{1,}$","gm")}},{key:"getInitialCharCode",value:function(code){return 12544+[49,50,52,55,56,57,65,66,67,70,71,72,73,74,75,76,77,78][(code-44032-(code-44032)%28)/28/21]}},{key:"getMedialCharCodeIndex",value:function(code){return(code-44032-(code-44032)%28)/28%21}},{key:"getMedialCharCode",value:function(code){return 12544+[79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99][this.getMedialCharCodeIndex(code)]}},{key:"getFinalCharCode",value:function(code){var index=(code-44032)%28;return(0===index?0:12544)+[0,49,50,51,52,53,54,55,57,58,59,60,61,62,63,64,65,66,68,69,70,71,72,74,75,76,77,78][index]}},{key:"numericToNotationString",value:function(num){var isHangul=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],ones=void 0,tens=void 0,teens=void 0;teens=isHangul?(ones=["","일","이","삼","사","오","육","칠","팔","구"],tens=["","일","이","삼","사","오","육","칠","팔","구"],["십","일","이","삼","사","오","육","칠","팔","구"]):(ones=["","one","two","three","four","five","six","seven","eight","nine"],tens=["","","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"],["ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"]);var convertTens=function(_num){if(_num<10)return ones[_num];if(!isHangul&&10<=_num&&_num<20)return teens[_num-10];if(isHangul&&_num<20)return"십"+ones[_num%10];var unit=isHangul?"십":" ";return""+tens[Math.floor(_num/10)]+unit+ones[_num%10]},convertHundreds=function(_num){if(99<_num){if(isHangul&&_num<200)return"백"+convertTens(_num%100);var unit=isHangul?"백":" hundred ";return""+ones[Math.floor(_num/100)]+unit+convertTens([_num%100])}return convertTens(_num)},convertThousands=function convertThousands(_num){if(1e3<=_num){if(isHangul&&_num<2e3)return"천"+convertHundreds(_num%1e3);var unit=isHangul?"천":" thousand ";return""+convertThousands(Math.floor(_num/1e3))+unit+convertHundreds([_num%1e3])}return convertHundreds(_num)};return 0===num?isHangul?"영":"zero":function convertMillions(_num){var base=isHangul?1e4:1e6;if(base<=_num){if(isHangul&&_num<2*base)return"만"+convertThousands(_num%base);var unit=isHangul?"만":" million ";return""+convertMillions(Math.floor(_num/base))+unit+convertThousands([_num%base])}return convertThousands(_num)}(num).trim()}},{key:"numericToOrdinalString",value:function(num){var _this2=this,suffix=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",ones=["","한","두","세","네","다섯","여섯","일곱","여덟","아홉"],tens=["","하나","둘","셋","넷","다섯","여섯","일곱","여덟","아홉"],teens=["","열","스물","서른","마흔","쉰","예순","일흔","여든","아흔"],c=null!==suffix.match(/^(명|공|달|시|종|벌|채|갈|쾌|근|문|큰|살|째)(?!러)/gm);if(!c&&suffix.length)return null;var _num,convertTens=function(_num){if(_num<10)return ones[_num];var unit=c?ones[_num%10]:tens[_num%10];return""+teens[Math.floor(_num/10)]+unit},convertHundreds=function(_num){return 99<_num?_num<200?"백"+convertTens(_num%100):_this2.numericToNotationString(Math.floor(_num/100))+"백"+convertTens(_num%100):convertTens(_num)},convertThousands=function(_num){return 1e3<=_num?_num<2e3?"천"+convertHundreds(_num%1e3):_this2.numericToNotationString(Math.floor(_num/1e3))+"천"+convertHundreds(_num%1e3):convertHundreds(_num)};return 0===num?null:1e4<=(_num=num)?_num<2e4?"만"+convertThousands(_num%1e4):_this2.numericToNotationString(Math.floor(_num/1e4))+"만"+convertThousands(_num%1e4):convertThousands(_num)}}]),TTSUtil}();exports.default=TTSUtil},{"../_Util":17}],22:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_TTSUtil=require("./TTSUtil"),_TTSUtil2=(obj=_TTSUtil)&&obj.__esModule?obj:{default:obj};var TTSUtterance=function(){function TTSUtterance(text){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TTSUtterance),this._text=text,this._length=text.length}return _createClass(TTSUtterance,[{key:"text",get:function(){return this._text}},{key:"length",get:function(){return this._length}}]),_createClass(TTSUtterance,[{key:"removeNewLine",value:function(){return new TTSUtterance(this.text.replace(_TTSUtil2.default.getNewLineRegex()," "))}},{key:"removeSpecialCharacters",value:function(characters){var regex=new RegExp("["+characters.join("")+"]","gm");return new TTSUtterance(this.text.replace(regex," "))}},{key:"removeHanja",value:function(){for(var text=this.text,i=0;i<this.length;i+=1)_TTSUtil2.default.isChineseCharCode(text.charCodeAt(i))&&(text=text.replace(text.substr(i,1)," "));return new TTSUtterance(text)}},{key:"removeLatin",value:function(){var removeList=[],text=this.text,length=this.length,startOffset=-1,i=void 0,j=void 0,k=void 0,ch=void 0,nextCh=void 0,prevCode=void 0,code=void 0,nextCode=void 0,checkRemoveRange=function(start,end){1<end-start&&removeList.push({startOffset:start,endOffset:end}),startOffset=-1};for(i=0;i<length;i+=1)if(code=text.charCodeAt(i),0<i&&_TTSUtil2.default.isLatinCharCode(code)){var isAbbr=!1;if(prevCode=text.charCodeAt(i-1),i+1<length&&(nextCode=text.charCodeAt(i+1),isAbbr=_TTSUtil2.default.isLatinCharCode(code,"u")&&_TTSUtil2.default.isLatinCharCode(nextCode,"u")),!isAbbr&&_TTSUtil2.default.isHangulCharCode(prevCode)&&(startOffset=i),0<startOffset){for(j=i+1;j<length;j+=1){if(code=text.charCodeAt(j),ch=text.charAt(j),_TTSUtil2.default.isSpaceCharCode(code)||_TTSUtil2.default.isLastCharOfSentence(ch)||":"===ch||","===ch)if(j+1<length){var ignoreCount=1;for(k=j+1;k<length;k+=1){if(nextCode=text.charCodeAt(k),nextCh=text.charAt(k),!_TTSUtil2.default.isSpaceCharCode(nextCode)&&":"!==nextCh&&","!==nextCh){if(_TTSUtil2.default.isLatinCharCode(nextCode)){j=k;break}checkRemoveRange(startOffset,k-ignoreCount),j=k-ignoreCount;break}ignoreCount+=1}}else checkRemoveRange(startOffset,j);else if(!_TTSUtil2.default.isLatinCharCode(code)){if(j+1<length&&(nextCode=text.charCodeAt(j+1),_TTSUtil2.default.isLatinCharCode(nextCode))){j+=1;continue}checkRemoveRange(startOffset,j)}if(-1===startOffset)break}-1!==startOffset&&checkRemoveRange(startOffset,length)}}var result="",endOffset=0;for(startOffset=i=0;i<removeList.length;i+=1)endOffset=removeList[i].startOffset,result+=text.substring(startOffset,endOffset),startOffset=removeList[i].endOffset;return new TTSUtterance(result+=text.substring(startOffset,length))}},{key:"replaceTilde",value:function(){var extendTable=["아","에","아","에","어","에","어","에","오","아","에","에","오","우","어","에","이","우","으","으","이"],textLength=this.length,text=this.text,offset=-1,i=void 0,j=void 0,k=void 0;for(i=0;i<textLength;i+=1){var code=text.charCodeAt(i);if(_TTSUtil2.default.isTildeCharCode(code)&&0<i){var isRangeTilde=!1;for(j=i+1;j<textLength;j+=1){var nextCode=text.charCodeAt(j);if(!_TTSUtil2.default.isSpaceCharCode(nextCode)){if(_TTSUtil2.default.isDigitCharCode(nextCode)){isRangeTilde=!0;break}break}}if(!isRangeTilde){var prevCode=text.charCodeAt(i-1);if(_TTSUtil2.default.isHangulCharCode(prevCode)&&0===_TTSUtil2.default.getFinalCharCode(prevCode)){var index=_TTSUtil2.default.getMedialCharCodeIndex(prevCode);text=text.replace(text.substr(i,1),extendTable[index]),offset=i}else _TTSUtil2.default.isLatinCharCode(prevCode)&&(text=text.replace(text.substr(i,1),text.substr(i-1,1)),offset=i)}}}if(-1!==offset){var insertRest=!0;for(k=offset+1;k<textLength;k+=1){if(_TTSUtil2.default.isHangulCharCode(text.charCodeAt(k))){insertRest=!1;break}if("?"!==text[k]&&"!"!==text[k])break}insertRest&&(textLength<=k?text+=",":text=text.substr(0,k)+","+text.substr(k))}return new TTSUtterance(text=text.replace(/∼|〜/gm,function(){return"에서 "}))}},{key:"removeAllRepeatedCharacter",value:function(strs){for(var text=this.text,i=0;i<strs.length;i+=1){var regex=new RegExp(strs[i]+"{2,}","gm");text=text.replace(regex,"")}return new TTSUtterance(text)}},{key:"replaceNumeric",value:function(){var Type_None=-1,Type_Latin=0,Type_HangulNotation=1,Type_HangulOrdinal=2,Type_Time=3,text=this.text;text=text.replace(/([\d]{0,})[,]([\d]{3,})/gm,"$1$2");var map={"⅐":"칠 분의 일","⅑":"구 분의 일","⅒":"십 분의 일","⅓":"삼 분의 일","⅔":"삼 분의 이","⅕":"오 분의 일","⅖":"오 분의 이","⅗":"오 분의 삼","⅘":"오 분의 사","⅙":"육 분의 일","⅚":"육 분의 오","⅛":"팔 분의 일","⅜":"팔 분의 삼","⅝":"팔 분의 오","⅞":"팔 분의 칠"};text=(text=text.replace(/⅐|⅑|⅒|⅓|⅔|⅕|⅖|⅗|⅘|⅙|⅚|⅛|⅜|⅝|⅞/gm,function(matched){return map[matched]})).replace(/([\d]{1,2})[Xx×]{2}/gm,"$100");for(var pattern=/[\d]{1,}/gm,match=void 0,startOffset=void 0,endOffset=void 0,i=void 0,code=void 0,ch=void 0;null!==(match=pattern.exec(text));){startOffset=match.index,endOffset=pattern.lastIndex;var origin=text.substring(startOffset,endOffset),numeric=parseInt(origin,10);if(isFinite(numeric)){var type=0===startOffset?Type_HangulNotation:Type_None,spaceCount=0;for(i=startOffset-1;0<=i;i-=1){if(code=text.charCodeAt(i),!_TTSUtil2.default.isSpaceCharCode(code)){if(_TTSUtil2.default.isColonCharCode(code)){type=Type_Time;break}if(i<startOffset-1&&_TTSUtil2.default.isLatinCharCode(code,"l")){type=Type_Latin;break}type=Type_None;break}spaceCount+=1}for(spaceCount===startOffset&&(type=Type_HangulNotation),i=endOffset;i<text.length;i+=1){code=text.charCodeAt(i),ch=text.charAt(i);var nextCh=text.charAt(i+1);if(!_TTSUtil2.default.isSpaceCharCode(code)){if(type===Type_Time||_TTSUtil2.default.isColonCharCode(code)){type=Type_Time;break}if(endOffset<i&&(type===Type_Latin||_TTSUtil2.default.isLatinCharCode(code,"l"))){type=Type_Latin;break}if(type!==Type_Latin&&"."===ch){type=Type_None;break}if("장"===ch||"권"===ch){type=Type_HangulNotation;break}if(_TTSUtil2.default.isLastCharOfSentence(ch))break;if(i===endOffset&&null!==(ch=_TTSUtil2.default.numericToOrdinalString(numeric,ch+nextCh))){type=Type_HangulOrdinal;break}type=Type_None;break}}var string=void 0;string=type===Type_HangulNotation||type===Type_HangulOrdinal||type===Type_Latin?type===Type_HangulOrdinal?ch:_TTSUtil2.default.numericToNotationString(numeric,type!==Type_Latin):origin,text=""+text.substr(0,startOffset)+string+text.substr(endOffset)}}return new TTSUtterance(text)}},{key:"replaceBracket",value:function(){for(var pattern=/\([\d]{1,2}\)/gm,text=this.text,match=void 0;null!==(match=pattern.exec(text));){var startOffset=match.index,endOffset=pattern.lastIndex,string=text.substring(startOffset+1,endOffset-1);(0===startOffset||0<=startOffset-1&&" "===text.substr(startOffset-1,1))&&(text=text.substr(0,startOffset)+"["+string+"]"+text.substr(endOffset))}return new TTSUtterance(text=text.replace(/\(([가나다라마바사아자차카타파하OX])\)/gm,"[$1]"))}},{key:"replaceEqual",value:function(){return new TTSUtterance(this.text.replace(/([^=])([=]{1})([^=])/gm,"$1는 $3"))}},{key:"replaceDate",value:function(){return new TTSUtterance(this.text)}},{key:"insertPauseTag",value:function(){var text=this.text;return new TTSUtterance(text=(text=(text=(text=(text=text.replace(/([\D])([·]{2,})([\D])/gm,"$1<pause='200ms'>$2$3")).replace(/([|_]{1})/gm,"<pause='400ms'>$1")).replace(/([…]{1,})/gm,"<pause='400ms'>$1")).replace(/([\D])(-|―){1,}([\D])/gm,"$1<pause='200ms'>$2$3")).replace(/^([\s]{0,}[\d]{1,}[\s]{1,})([^-―·|…_<])/gm,"$1<pause='200ms'>$2"))}}]),TTSUtterance}();exports.default=TTSUtterance},{"./TTSUtil":21}],23:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_TTSPiece2=_interopRequireDefault(require("./TTSPiece")),_TTSChunk2=_interopRequireDefault(require("./TTSChunk")),_TTSRange2=_interopRequireDefault(require("./TTSRange")),_TTSUtil2=_interopRequireDefault(require("./TTSUtil"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _TTS=function(){function _TTS(reader){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,_TTS),this._reader=reader,this.debug=!1,this._reserveNodesCountMagic=40,this._makeChunksInterval=100,this._processedNodeMinIndex=-1,this._processedNodeMaxIndex=-1,this._generateMoreChunksTimeoutId=0,this._didFinishMakeChunksEnabled=!1,this._chunks=[]}return _createClass(_TTS,[{key:"reader",get:function(){return this._reader}},{key:"nodes",get:function(){return this.reader.content.nodes}},{key:"chunks",get:function(){return this._chunks}},{key:"reserveNodesCountMagic",get:function(){return this._reserveNodesCountMagic}},{key:"makeChunksInterval",get:function(){return this._makeChunksInterval}},{key:"processedNodeMinIndex",get:function(){return this._processedNodeMinIndex}},{key:"processedNodeMaxIndex",get:function(){return this._processedNodeMaxIndex}},{key:"didFinishMakeChunksEnabled",get:function(){return this._didFinishMakeChunksEnabled}}]),_createClass(_TTS,[{key:"_serializedRangeToNodeLocation",value:function(serializedRange){var range=rangy.deserializeRange(serializedRange,document.body);if(null===range)throw new Error("TTS: range is invalid.");var nodes=this.nodes,nodeIndex=-1,wordIndex=0;if(nodes)for(var i=0,offset=0;i<nodes.length;i+=1,offset=0)if(nodes[i]===range.startContainer){nodeIndex=i;for(var words=range.startContainer.textContent.split(_TTSUtil2.default.getSplitWordRegex());wordIndex<words.length&&!(range.startOffset<=offset+words[wordIndex].length);wordIndex+=1)offset+=words[wordIndex].length+1;break}return{nodeIndex:nodeIndex,wordIndex:wordIndex}}},{key:"playChunksBySerializedRange",value:function(serializedRange){var nodeLocation=this._serializedRangeToNodeLocation(serializedRange);this.playChunksByNodeLocation(nodeLocation.nodeIndex,nodeLocation.wordIndex)}},{key:"playChunksByNodeLocation",value:function(nodeIndex,wordIndex){this.makeChunksByNodeLocation(nodeIndex,wordIndex,!0),0===this.chunks.length&&this.makeChunksByNodeLocationReverse(nodeIndex,wordIndex,!0),0<this.chunks.length?(this._chunks=[this.chunks[0]],this.didFinishMakePartialChunks(!0,!1)):this.didFinishMakeChunks()}},{key:"makeLastSentenceChunksInSpine",value:function(){this.makeChunksByNodeLocationReverse(-1,-1,!0);for(var emptyChunkRegex=_TTSUtil2.default.getWhitespaceAndNewLineRegex("^","$",null),lastSentenceChunk=null,i=this.chunks.length-1;0<=i&&(lastSentenceChunk=this.chunks[i]).getUtterance().text.match(emptyChunkRegex);i-=1)lastSentenceChunk=null;lastSentenceChunk?(this._chunks=[],this.makeAdjacentChunksByNodeLocation(lastSentenceChunk.getStartNodeIndex(),lastSentenceChunk.getStartWordIndex())):(this._didFinishMakeChunksEnabled=!0,this.didFinishMakeChunks())}},{key:"makeAdjacentChunksBySerializedRange",value:function(serializedRange){var nodeLocation=this._serializedRangeToNodeLocation(serializedRange);this.makeAdjacentChunksByNodeLocation(nodeLocation.nodeIndex,nodeLocation.wordIndex)}},{key:"makeAdjacentChunksByNodeLocation",value:function(){var _this=this,nodeIndex=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1,wordIndex=1<arguments.length&&void 0!==arguments[1]?arguments[1]:-1;this._didFinishMakeChunksEnabled=!0,this.makeChunksByNodeLocation(nodeIndex,wordIndex),this.chunks.shift();var firstChunk=this.chunks[0],endNodeIndex=-1,endWordIndex=-1;firstChunk&&(endNodeIndex=firstChunk.getStartNodeIndex(),(endWordIndex=firstChunk.getStartWordIndex()-1)<0&&(endNodeIndex-=1)),this.makeChunksByNodeLocationReverse(endNodeIndex,endWordIndex),this.didFinishMakePartialChunks(!1,!1),this.playChunksByNodeLocation(nodeIndex,wordIndex);var nodes=this.nodes;if(nodes){var hasMoreAfterChunks=function(){return _this.processedNodeMaxIndex+1<nodes.length},hasMoreBeforeChunks=function(){return 0<=_this.processedNodeMinIndex-1},generateMoreChunks=function(){},scheduleTask=function(){if(hasMoreAfterChunks()||hasMoreBeforeChunks()){var timeoutId=_this._generateMoreChunksTimeoutId;0<_this.makeChunksInterval?setTimeout(function(){return generateMoreChunks(timeoutId)},_this.makeChunksInterval):generateMoreChunks(timeoutId)}else _this.didFinishMakeChunks()};generateMoreChunks=function(timeoutId){timeoutId===_this._generateMoreChunksTimeoutId&&(hasMoreAfterChunks()&&(_this.makeChunksByNodeLocation(_this.processedNodeMaxIndex+1),_this.didFinishMakePartialChunks(!1,!1)),hasMoreBeforeChunks()&&(_this.makeChunksByNodeLocationReverse(_this.processedNodeMinIndex-1),_this.didFinishMakePartialChunks(!1,!0)),scheduleTask())},scheduleTask()}}},{key:"makeChunksByNodeLocation",value:function(){var nodeIndex=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1,_this2=this,wordIndex=1<arguments.length&&void 0!==arguments[1]?arguments[1]:-1,isMakingTemporalChunk=2<arguments.length&&void 0!==arguments[2]&&arguments[2],nodes=this.nodes;if(null===nodes)return 0;for(var _nodeIndex=Math.max(nodeIndex,0),_wordIndex=Math.max(wordIndex,0),reserveNodesCount=isMakingTemporalChunk?0:this.reserveNodesCountMagic,maxIndex=Math.min(_nodeIndex+reserveNodesCount,nodes.length-1),incrementMaxIndex=function(){maxIndex=Math.min(maxIndex+1,nodes.length-1)},pieceBuffer=[],flushPieces=function(){_this2._addChunk(pieceBuffer,!1),pieceBuffer=[]};_nodeIndex<=maxIndex+1;_nodeIndex+=1,_wordIndex=-1){if(_nodeIndex>=nodes.length){flushPieces();break}var piece=void 0;try{piece=new _TTSPiece2.default(nodes[_nodeIndex],_nodeIndex,_wordIndex)}catch(e){console.error(e);break}var aboveMaxIndex=maxIndex<_nodeIndex;piece.isInvalid()?aboveMaxIndex||incrementMaxIndex():piece.isOnlyWhitespace()?(flushPieces(),aboveMaxIndex||incrementMaxIndex()):!aboveMaxIndex&&piece.isSiblingBrRecursive(!0)?(pieceBuffer.push(piece),flushPieces()):(aboveMaxIndex||pieceBuffer.push(piece),!aboveMaxIndex&&1<piece.length&&piece.isSentence()?flushPieces():maxIndex<=_nodeIndex&&(incrementMaxIndex(),aboveMaxIndex&&(_nodeIndex-=1)))}return isMakingTemporalChunk||(this._processedNodeMaxIndex=maxIndex),this.chunks.length}},{key:"makeChunksByNodeLocationReverse",value:function(){var nodeIndex=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1,_this3=this,wordIndex=1<arguments.length&&void 0!==arguments[1]?arguments[1]:-1,isMakingTemporalChunk=2<arguments.length&&void 0!==arguments[2]&&arguments[2],nodes=this.nodes;if(null===nodes)return 0;for(var node,maxNodeIndex=nodes.length-1,_nodeIndex=0<=nodeIndex?Math.min(nodeIndex,maxNodeIndex):maxNodeIndex,maxWordIndex=(node=nodes[_nodeIndex],node?(node.nodeValue||"").split(_TTSUtil2.default.getSplitWordRegex()):[]).length-1,startWordIndex=0,endWordIndex=0<=wordIndex?Math.min(wordIndex,maxWordIndex):maxWordIndex,reserveNodesCount=isMakingTemporalChunk?0:this.reserveNodesCountMagic,minIndex=Math.max(0,_nodeIndex-reserveNodesCount),decrementMinIndex=function(){minIndex=Math.max(minIndex-1,0)},pieceBuffer=[],flushPieces=function(){_this3._addChunk(pieceBuffer,!0),pieceBuffer=[]},initMinIndex=minIndex;minIndex-1<=_nodeIndex;_nodeIndex-=1,endWordIndex=startWordIndex=-1){if(_nodeIndex<0){flushPieces();break}var piece=void 0;try{piece=new _TTSPiece2.default(nodes[_nodeIndex],_nodeIndex,startWordIndex,endWordIndex)}catch(e){console.error(e);break}var belowMinIndex=_nodeIndex<minIndex;if(piece.isInvalid())belowMinIndex||decrementMinIndex();else if(piece.isOnlyWhitespace())flushPieces(),belowMinIndex||decrementMinIndex();else if(!belowMinIndex&&piece.isSiblingBrRecursive(!1))pieceBuffer.unshift(piece),flushPieces();else{var isCurrentPieceSentence=1<piece.length&&piece.isSentence();if(isCurrentPieceSentence&&(flushPieces(),_nodeIndex<initMinIndex&&0<this.chunks.length)){minIndex=_nodeIndex+1;break}belowMinIndex?isCurrentPieceSentence||(decrementMinIndex(),_nodeIndex+=1):(pieceBuffer.unshift(piece),_nodeIndex===minIndex&&decrementMinIndex())}}return isMakingTemporalChunk||(this._processedNodeMinIndex=minIndex),this.chunks.length}},{key:"didFinishMakePartialChunks",value:function(){throw new Error("Must override this method")}},{key:"didFinishMakeChunks",value:function(){return!!this.didFinishMakeChunksEnabled&&!(this._didFinishMakeChunksEnabled=!1)}},{key:"_addChunk",value:function(pieces,addAtFirst){var _this4=this;if(0!==pieces.length){var nextText,RIDI="RidiDelimiter",debug=function(caseNum,chunk){_this4.debug&&chunk&&console.log("Case: "+caseNum+", Text: "+chunk.getText())},makeTrimmedRange=function(startOffset,text){var paddingLeft=(text.match(/^([\s]+)/g)||[""])[0].length,paddingRight=(text.match(/([\s]+)$/g)||[""])[0].length;return new _TTSRange2.default(startOffset+paddingLeft,startOffset+text.length-paddingRight)},buffer=[],pushToChunks=function(chunk){return addAtFirst?buffer.push(chunk):_this4.chunks.push(chunk),chunk},chunk=new _TTSChunk2.default(pieces),tokens=_TTSUtil2.default.mergeSentencesWithinBrackets(chunk.getText().replace(/([.。?!])/gm,"$1["+RIDI+"]").split("["+RIDI+"]").filter(function(splitText){return 0<splitText.trim().length}));if(1<tokens.length){for(var offset=0,startOffset=0,subText="",i=0;i<tokens.length;i+=1){var token=tokens[i];subText+=token,offset+=token.length,_TTSUtil2.default.isPeriodPointOrName(subText,tokens[i+1])||void 0!==(nextText=tokens[i+1])&&null!==nextText.match(_TTSUtil2.default.getSentenceRegex("^"))||(subText.length&&(debug(1,pushToChunks(chunk.copy(makeTrimmedRange(startOffset,subText)))),subText=""),startOffset=offset)}subText.length&&debug(2,pushToChunks(chunk.copy(makeTrimmedRange(startOffset,subText))))}else 1===tokens.length&&debug(3,pushToChunks(chunk.copy(makeTrimmedRange(0,tokens[0]))));if(addAtFirst)for(;0<buffer.length;)this.chunks.unshift(buffer.pop())}}},{key:"flush",value:function(){this._processedNodeMinIndex=-1,this._processedNodeMaxIndex=-1,this._generateMoreChunksTimeoutId+=1,this._didFinishMakeChunksEnabled=!1,this._chunks=[]}}]),_TTS}();exports.default=_TTS},{"./TTSChunk":18,"./TTSPiece":19,"./TTSRange":20,"./TTSUtil":21}]},{},[8])(8)}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(predicate){if(null==this)throw new TypeError('"this" is null or not defined');var o=Object(this),len=o.length>>>0;if("function"!=typeof predicate)throw new TypeError("predicate must be a function");for(var thisArg=arguments[1],k=0;k<len;){var kValue=o[k];if(predicate.call(thisArg,kValue,k,o))return kValue;k++}},configurable:!0,writable:!0}),Array.from||(Array.from=function(){var toStr=Object.prototype.toString,isCallable=function(fn){return"function"==typeof fn||"[object Function]"===toStr.call(fn)},maxSafeInteger=Math.pow(2,53)-1,toLength=function(value){var len=function(value){var number=Number(value);return isNaN(number)?0:0!==number&&isFinite(number)?(0<number?1:-1)*Math.floor(Math.abs(number)):number}(value);return Math.min(Math.max(len,0),maxSafeInteger)};return function(arrayLike){var items=Object(arrayLike);if(null==arrayLike)throw new TypeError("Array.from requires an array-like object - not null or undefined");var T,mapFn=1<arguments.length?arguments[1]:void 0;if(void 0!==mapFn){if(!isCallable(mapFn))throw new TypeError("Array.from: when provided, the second argument must be a function");2<arguments.length&&(T=arguments[2])}for(var kValue,len=toLength(items.length),A=isCallable(this)?Object(new this(len)):new Array(len),k=0;k<len;)kValue=items[k],A[k]=mapFn?void 0===T?mapFn(kValue,k):mapFn.call(T,kValue,k):kValue,k+=1;return A.length=len,A}}()),"function"!=typeof window.getMatchedCSSRules){var ELEMENT_RE=/[\w-]+/g,ID_RE=/#[\w-]+/g,CLASS_RE=/\.[\w-]+/g,ATTR_RE=/\[[^\]]+\]/g,PSEUDO_CLASSES_RE=/\:(?!not)[\w-]+(\(.*\))?/g,PSEUDO_ELEMENTS_RE=/\:\:?(after|before|first-letter|first-line|selection)/g;function toArray(list){return[].slice.call(list||[])}function getSheetRules(stylesheet){var sheet_media=stylesheet.media&&stylesheet.media.mediaText;return stylesheet.disabled?[]:sheet_media&&sheet_media.length&&!window.matchMedia(sheet_media).matches?[]:toArray(stylesheet.cssRules)}function _find(string,re){string.match(re);return re?re.length:0}function calculateScore(selector){for(var part,match,score=[0,0,0],parts=selector.split(" ");"string"==typeof(part=parts.shift());)match=_find(part,PSEUDO_ELEMENTS_RE),(score[2]=match)&&(part=part.replace(PSEUDO_ELEMENTS_RE,"")),match=_find(part,PSEUDO_CLASSES_RE),(score[1]=match)&&(part=part.replace(PSEUDO_CLASSES_RE,"")),match=_find(part,ATTR_RE),score[1]+=match,match&&(part=part.replace(ATTR_RE,"")),match=_find(part,ID_RE),(score[0]=match)&&(part=part.replace(ID_RE,"")),match=_find(part,CLASS_RE),score[1]+=match,match&&(part=part.replace(CLASS_RE,"")),score[2]+=_find(part,ELEMENT_RE);return parseInt(score.join(""),10)}function getSpecificityScore(element,selector_text){for(var selector,score,selectors=selector_text.split(","),result=0;selector=selectors.shift();)element.webkitMatchesSelector(selector)&&(result=result<(score=calculateScore(selector))?score:result);return result}function sortBySpecificity(element,rules){return rules.sort(function(a,b){return getSpecificityScore(element,b.selectorText)-getSpecificityScore(element,a.selectorText)})}window.getMatchedCSSRules=function(element){var style_sheets,sheet,rules,rule,result=[];for(style_sheets=toArray(window.document.styleSheets);sheet=style_sheets.shift();)for(rules=getSheetRules(sheet);rule=rules.shift();)rule.styleSheet?rules=getSheetRules(rule.styleSheet).concat(rules):rule.media?rules=getSheetRules(rule).concat(rules):rule.selectorText&&0!==rule.selectorText.length&&element.webkitMatchesSelector(rule.selectorText)&&result.push(rule);return sortBySpecificity(element,result)}}!function(factory){"function"==typeof define&&define.amd?define([],factory):"object"==typeof module&&module.exports?module.exports=factory():window.idleCallbackShim=factory()}(function(){"use strict";var scheduleStart,throttleDelay,lazytimer,lazyraf,fn,id,timestamp,check,root="undefined"!=typeof window?window:null!=typeof global?global:this||{},requestAnimationFrame=root.cancelRequestAnimationFrame&&root.requestAnimationFrame||setTimeout,cancelRequestAnimationFrame=root.cancelRequestAnimationFrame||clearTimeout,tasks=[],runAttempts=0,isRunning=!1,remainingTime=7,minThrottle=35,throttle=125,index=0,taskStart=0,tasklength=0,IdleDeadline={get didTimeout(){return!1},timeRemaining:function(){var timeRemaining=remainingTime-(Date.now()-taskStart);return timeRemaining<0?0:timeRemaining}},setInactive=(fn=function(){remainingTime=22,throttle=66,minThrottle=0},check=function(){var last=Date.now()-timestamp;last<99?id=setTimeout(check,99-last):(id=null,fn())},function(){timestamp=Date.now(),id||(id=setTimeout(check,99))});function onInputorMutation(){125!=throttle&&(remainingTime=7,throttle=125,minThrottle=35,isRunning&&(isRunning&&(lazyraf&&cancelRequestAnimationFrame(lazyraf),lazytimer&&clearTimeout(lazytimer),isRunning=!1),scheduleLazy())),setInactive()}function scheduleAfterRaf(){lazyraf=null,lazytimer=setTimeout(runTasks,0)}function scheduleRaf(){lazytimer=null,requestAnimationFrame(scheduleAfterRaf)}function scheduleLazy(){isRunning||(throttleDelay=throttle-(Date.now()-taskStart),scheduleStart=Date.now(),isRunning=!0,minThrottle&&throttleDelay<minThrottle&&(throttleDelay=minThrottle),9<throttleDelay?lazytimer=setTimeout(scheduleRaf,throttleDelay):(throttleDelay=0,scheduleRaf()))}function runTasks(){var task,i,len,timeThreshold=9<remainingTime?9:1;if(taskStart=Date.now(),isRunning=!1,lazytimer=null,2<runAttempts||taskStart-throttleDelay-50<scheduleStart)for(i=0,len=tasks.length;i<len&&IdleDeadline.timeRemaining()>timeThreshold;i++)task=tasks.shift(),tasklength++,task&&task(IdleDeadline);tasks.length?scheduleLazy():runAttempts=0}function requestIdleCallbackShim(task){return index++,tasks.push(task),scheduleLazy(),index}function cancelIdleCallbackShim(id){var index=id-1-tasklength;tasks[index]&&(tasks[index]=null)}if(root.requestIdleCallback&&root.cancelIdleCallback)try{root.requestIdleCallback(function(){},{timeout:0})}catch(e){!function(rIC){var timeRemainingProto,timeRemaining;if(root.requestIdleCallback=function(fn,timeout){return timeout&&"number"==typeof timeout.timeout?rIC(fn,timeout.timeout):rIC(fn)},root.IdleCallbackDeadline&&(timeRemainingProto=IdleCallbackDeadline.prototype)){if(!(timeRemaining=Object.getOwnPropertyDescriptor(timeRemainingProto,"timeRemaining"))||!timeRemaining.configurable||!timeRemaining.get)return;Object.defineProperty(timeRemainingProto,"timeRemaining",{value:function(){return timeRemaining.get.call(this)},enumerable:!0,configurable:!0})}}(root.requestIdleCallback)}else root.requestIdleCallback=requestIdleCallbackShim,root.cancelIdleCallback=cancelIdleCallbackShim,root.document&&document.addEventListener&&(root.addEventListener("scroll",onInputorMutation,!0),root.addEventListener("resize",onInputorMutation),document.addEventListener("focus",onInputorMutation,!0),document.addEventListener("mouseover",onInputorMutation,!0),["click","keypress","touchstart","mousedown"].forEach(function(name){document.addEventListener(name,onInputorMutation,{capture:!0,passive:!0})}),root.MutationObserver&&new MutationObserver(onInputorMutation).observe(document.documentElement,{childList:!0,subtree:!0,attributes:!0}));return{request:requestIdleCallbackShim,cancel:cancelIdleCallbackShim}}),"function"!=typeof Object.assign&&(Object.assign=function(target){"use strict";if(null==target)throw new TypeError("Cannot convert undefined or null to object");for(var output=Object(target),index=1;index<arguments.length;index++){var source=arguments[index];if(null!=source)for(var nextKey in source)source.hasOwnProperty(nextKey)&&(output[nextKey]=source[nextKey])}return output});var crc32=function(){var cachedCrcTable=null;return function(str){for(var utf8CharCodes=function(str){for(var c,utf8CharCodes=[],i=0,len=str.length;i<len;++i)(c=str.charCodeAt(i))<128?utf8CharCodes.push(c):c<2048?utf8CharCodes.push(c>>6|192,63&c|128):utf8CharCodes.push(c>>12|224,c>>6&63|128,63&c|128);return utf8CharCodes}(str),crc=-1,crcTable=(cachedCrcTable||(cachedCrcTable=function(){for(var j,crc,table=[],i=0;i<256;++i){for(crc=i,j=8;j--;)1==(1&crc)?crc=crc>>>1^3988292384:crc>>>=1;table[i]=crc>>>0}return table}()),cachedCrcTable),i=0,len=utf8CharCodes.length;i<len;++i)crc=crc>>>8^crcTable[255&(crc^utf8CharCodes[i])];return(-1^crc)>>>0}}(),rangy={nodeToInfoString:function(node,infoParts){var escapeTextForHtml=function(str){return str.replace(/</g,"&lt;").replace(/>/g,"&gt;")};infoParts=infoParts||[];var nodeType=node.nodeType,children=node.childNodes,childCount=children.length,nodeInfo=[nodeType,node.nodeName,childCount].join(":"),start="",end="";switch(nodeType){case 3:start=escapeTextForHtml(node.nodeValue);break;case 8:start="\x3c!--"+escapeTextForHtml(node.nodeValue)+"--\x3e";break;default:start="<"+nodeInfo+">",end="</>"}start&&infoParts.push(start);for(var i=0;i<childCount;++i)rangy.nodeToInfoString(children[i],infoParts);return end&&infoParts.push(end),infoParts},getElementChecksum:function(el){var info=rangy.nodeToInfoString(el).join("");return crc32(info).toString(16)},getDocument:function(node){if(9==node.nodeType)return node;if(void 0!==node.ownerDocument)return node.ownerDocument;if(void 0!==node.document)return node.document;if(node.parentNode)return rangy.getDocument(node.parentNode);throw new Error("Error in Rangy: getDocument: no document found for node")},getNodeIndex:function(node){for(var i=0;node=node.previousSibling;)++i;return i},getNodeLength:function(node){switch(node.nodeType){case 7:case 10:return 0;case 3:case 8:return node.length;default:return node.childNodes.length}},serializePosition:function(node,offset,rootNode){var pathParts=[],n=node;for(rootNode=rootNode||rangy.getDocument(node).documentElement;n&&n!=rootNode;)pathParts.push(rangy.getNodeIndex(n,!0)),n=n.parentNode;return pathParts.join("/")+":"+offset},serializeRange:function(range,omitChecksum,rootNode){if(!function(ancestor,descendant,selfIsAncestor){for(var n=selfIsAncestor?descendant:descendant.parentNode;n;){if(n===ancestor)return!0;n=n.parentNode}return!1}(rootNode=rootNode||rangy.getDocument(range).startContainer,range.commonAncestorContainer,!0))throw new Error("Error in Rangy: serializeRange(): range is not wholly contained within specified root node.");var serialized=rangy.serializePosition(range.startContainer,range.startOffset,rootNode)+","+rangy.serializePosition(range.endContainer,range.endOffset,rootNode);return omitChecksum||(serialized+="{"+rangy.getElementChecksum(rootNode)+"}"),serialized},deserializePosition:function(serialized,rootNode,doc){rootNode||(rootNode=(doc||document).documentElement);for(var nodeIndex,parts=serialized.split(":"),node=rootNode,nodeIndices=parts[0]?parts[0].split("/"):[],i=nodeIndices.length;i--;){if(!((nodeIndex=parseInt(nodeIndices[i],10))<node.childNodes.length))throw new Error("Error in Rangy: deserializePosition() failed: node has no child with index "+nodeIndex+", "+i+".");node=node.childNodes[nodeIndex]}return{node:node,offset:parseInt(parts[1],10)}},deserializeRegex:/^([^,]+),([^,\{]+)(\{([^}]+)\})?$/,deserializeRange:function(serialized,rootNode,doc){rootNode?doc=doc||rangy.getDocument(rootNode):rootNode=(doc=doc||document).documentElement;var rootNodeChecksum,result=rangy.deserializeRegex.exec(serialized),checksum=result[4];if(checksum&&checksum!==(rootNodeChecksum=rangy.getElementChecksum(rootNode)))throw new Error("deserializeRange: checksums of serialized range root node ("+checksum+") and target root node ("+rootNodeChecksum+") do not match");var start=rangy.deserializePosition(result[1],rootNode,doc),end=rangy.deserializePosition(result[2],rootNode,doc),range=document.createRange();return range.setStart(start.node,start.offset),range.setEnd(end.node,end.offset),range},canDeserializeRange:function(serialized,rootNode,doc){rootNode||(rootNode=(doc||document).documentElement);var checksum=rangy.deserializeRegex.exec(serialized)[3];return!checksum||checksum===rangy.getElementChecksum(rootNode)}};